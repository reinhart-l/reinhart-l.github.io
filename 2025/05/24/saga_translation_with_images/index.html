<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="英文原文 (Original Text)Announcing SAGA: Skill to Action Generation for Agents.Demo Video of SAGA in Action IntroductionToday, we are announcing SAGA: Skill to Action Generation for Agents, a generative A">
<meta property="og:type" content="article">
<meta property="og:title" content="SAGA 面向代理的技能到行动生成框架">
<meta property="og:url" content="http://example.com/2025/05/24/saga_translation_with_images/index.html">
<meta property="og:site_name" content="Across the Cosmos">
<meta property="og:description" content="英文原文 (Original Text)Announcing SAGA: Skill to Action Generation for Agents.Demo Video of SAGA in Action IntroductionToday, we are announcing SAGA: Skill to Action Generation for Agents, a generative A">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523115938242.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120006872.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120023216.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120107338.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120133772.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120145045.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120159076.png">
<meta property="og:image" content="d:\Document\typorapic\saga_translation_with_images\image-20250523120214260.png">
<meta property="og:image" content="d:\Document\typorapic\saga_translation_with_images\image-20250523120224356.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120244409.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120256805.png">
<meta property="og:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120423179.png">
<meta property="article:published_time" content="2025-05-24T05:41:25.000Z">
<meta property="article:modified_time" content="2025-05-24T07:19:27.547Z">
<meta property="article:author" content="Reinhart">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="NPC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523115938242.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SAGA 面向代理的技能到行动生成框架</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="Across the Cosmos" type="application/atom+xml" />
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/05/24/LARP%20LANGUAGE-AGENT%20ROLE%20PLAY%20FOR%20OPEN-WORLD%20GAMES/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/16/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%B0%8F%E9%95%87%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/05/24/saga_translation_with_images/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://example.com/2025/05/24/saga_translation_with_images/&text=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/05/24/saga_translation_with_images/&is_video=false&description=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SAGA 面向代理的技能到行动生成框架&body=Check out this article: http://example.com/2025/05/24/saga_translation_with_images/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://example.com/2025/05/24/saga_translation_with_images/&name=SAGA 面向代理的技能到行动生成框架&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/05/24/saga_translation_with_images/&t=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text"><span class="toc-number">1.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Announcing-SAGA-Skill-to-Action-Generation-for-Agents"><span class="toc-number"></span> <span class="toc-text">Announcing SAGA: Skill to Action Generation for Agents.</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation"><span class="toc-number">2.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%A3%E5%B8%83SAGA%EF%BC%9A%E9%9D%A2%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E6%8A%80%E8%83%BD%E5%88%B0%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E6%A1%86%E6%9E%B6"><span class="toc-number"></span> <span class="toc-text">宣布SAGA：面向代理的技能到行动生成框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-1"><span class="toc-number">2.</span> <span class="toc-text">英文原文 (Original Text)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Skills-in-Action"><span class="toc-number">2.1.</span> <span class="toc-text">Skills in Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Examples"><span class="toc-number">2.2.</span> <span class="toc-text">Examples</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-1"><span class="toc-number">3.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E4%BB%98%E8%AF%B8%E8%A1%8C%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">技能付诸行动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.2.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-2"><span class="toc-number">4.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pairing-With-a-Simulation"><span class="toc-number">5.</span> <span class="toc-text">Pairing With a Simulation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-2"><span class="toc-number">6.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E6%A8%A1%E6%8B%9F%E7%B3%BB%E7%BB%9F%E9%85%8D%E5%AF%B9"><span class="toc-number">7.</span> <span class="toc-text">与模拟系统配对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-3"><span class="toc-number">8.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Murder-in-Thistle-Gulch"><span class="toc-number">9.</span> <span class="toc-text">Murder in Thistle Gulch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Personas"><span class="toc-number">9.1.</span> <span class="toc-text">Personas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meta-Memories"><span class="toc-number">9.2.</span> <span class="toc-text">Meta-Memories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-3"><span class="toc-number">10.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%93%9F%E8%8D%89%E5%B3%A1%E8%B0%B7%E4%B8%AD%E7%9A%84%E8%B0%8B%E6%9D%80%E6%A1%88"><span class="toc-number">11.</span> <span class="toc-text">蓟草峡谷中的谋杀案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E8%AE%BE%E5%AE%9A"><span class="toc-number">11.1.</span> <span class="toc-text">角色设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E8%AE%B0%E5%BF%86"><span class="toc-number">11.2.</span> <span class="toc-text">元记忆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-4"><span class="toc-number">12.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Murder-Investigation"><span class="toc-number">13.</span> <span class="toc-text">The Murder Investigation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sheriff-Cooper"><span class="toc-number">13.1.</span> <span class="toc-text">Sheriff Cooper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Saloon-Owner"><span class="toc-number">13.2.</span> <span class="toc-text">Saloon Owner</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-4"><span class="toc-number">14.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%8B%E6%9D%80%E8%B0%83%E6%9F%A5"><span class="toc-number">15.</span> <span class="toc-text">谋杀调查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sheriff-Cooper-1"><span class="toc-number">15.1.</span> <span class="toc-text">Sheriff Cooper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%92%E9%A6%86%E8%80%81%E6%9D%BF"><span class="toc-number">15.2.</span> <span class="toc-text">酒馆老板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-5"><span class="toc-number">16.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cooperation-and-Conflict"><span class="toc-number">17.</span> <span class="toc-text">Cooperation and Conflict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-5"><span class="toc-number">18.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E4%BD%9C%E4%B8%8E%E5%86%B2%E7%AA%81"><span class="toc-number">19.</span> <span class="toc-text">合作与冲突</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-6"><span class="toc-number">20.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-6"><span class="toc-number">21.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-7"><span class="toc-number">22.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Related-Work"><span class="toc-number">23.</span> <span class="toc-text">Related Work</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI-Planning-in-Context"><span class="toc-number">24.</span> <span class="toc-text">AI Planning in Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-7"><span class="toc-number">25.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="toc-number">26.</span> <span class="toc-text">相关工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E8%A7%84%E5%88%92%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">27.</span> <span class="toc-text">AI规划的上下文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-8"><span class="toc-number">28.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Language-Models-as-Zero-Shot-Planners"><span class="toc-number">29.</span> <span class="toc-text">Language Models as Zero-Shot Planners</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generative-Human-like-Agents"><span class="toc-number">30.</span> <span class="toc-text">Generative Human-like Agents</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-8"><span class="toc-number">31.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E9%9B%B6%E6%A0%B7%E6%9C%AC%E8%A7%84%E5%88%92%E5%99%A8%E7%9A%84%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B"><span class="toc-number">32.</span> <span class="toc-text">作为零样本规划器的语言模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E7%B1%BB%E4%BA%BA%E4%BB%A3%E7%90%86"><span class="toc-number">33.</span> <span class="toc-text">生成式类人代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-9"><span class="toc-number">34.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interacting-With-and-Planning-in-a-3D-World"><span class="toc-number">35.</span> <span class="toc-text">Interacting With and Planning in a 3D World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-9"><span class="toc-number">36.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A83D%E4%B8%96%E7%95%8C%E4%B8%AD%E4%BA%A4%E4%BA%92%E5%92%8C%E8%A7%84%E5%88%92"><span class="toc-number">37.</span> <span class="toc-text">在3D世界中交互和规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-10"><span class="toc-number">38.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Next-Steps"><span class="toc-number">39.</span> <span class="toc-text">Next Steps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenges-for-Production-Use"><span class="toc-number">40.</span> <span class="toc-text">Challenges for Production Use</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generation-Times"><span class="toc-number">40.1.</span> <span class="toc-text">Generation Times</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-and-Prompt-Size-Limits"><span class="toc-number">40.2.</span> <span class="toc-text">Memory and Prompt Size Limits</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-10"><span class="toc-number">41.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5"><span class="toc-number">42.</span> <span class="toc-text">下一步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">43.</span> <span class="toc-text">生产使用的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%97%B6%E9%97%B4"><span class="toc-number">43.1.</span> <span class="toc-text">生成时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%92%8C%E6%8F%90%E7%A4%BA%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6"><span class="toc-number">43.2.</span> <span class="toc-text">内存和提示大小限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-11"><span class="toc-number">44.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAGA%E2%80%99s-Future-Goals"><span class="toc-number">45.</span> <span class="toc-text">SAGA’s Future Goals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-11"><span class="toc-number">46.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAGA%E7%9A%84%E6%9C%AA%E6%9D%A5%E7%9B%AE%E6%A0%87"><span class="toc-number">47.</span> <span class="toc-text">SAGA的未来目标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SAGA%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90"><span class="toc-number"></span> <span class="toc-text">SAGA项目代码流程详细解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SAGA%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">1. SAGA核心架构与组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 主要组件概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 核心组件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-BaseSagaAgent"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 BaseSagaAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-ActionsAgent"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 ActionsAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-ConversationAgent"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 ConversationAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-EmbeddingAgent"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 EmbeddingAgent</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 关键数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">2. 核心工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 总体流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AF%A6%E7%BB%86%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 详细执行流程概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 行动生成流程详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 详细流程图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E6%8F%90%E7%A4%BA%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 提示模板设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E8%A1%8C%E5%8A%A8%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 行动解析和排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AF%B9%E8%AF%9D%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 对话生成流程详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%AE%8C%E6%95%B4%E7%9A%84%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 完整的模拟执行流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E9%A9%B1%E5%8A%A8%E6%B5%81%E7%A8%8B%EF%BC%88%E4%BB%A5Space-Colony%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 模拟环境中的用户交互驱动流程（以Space Colony示例）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-SAGA%E5%86%85%E9%83%A8%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E5%88%B0%E6%89%A7%E8%A1%8C%E7%9A%84%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 SAGA内部行动生成到执行的详细流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AE%B0%E5%BF%86%E4%B8%8E%E5%B5%8C%E5%85%A5%E6%9C%BA%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">3. 记忆与嵌入机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-EmbeddingAgent-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 EmbeddingAgent 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SimpleVectorStore-%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 SimpleVectorStore 实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%AE%B0%E5%BF%86%E5%92%8C%E5%85%83%E8%AE%B0%E5%BF%86%E5%A4%84%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 记忆和元记忆处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E9%9B%86%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">4. 模拟环境集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A8%A1%E6%8B%9F%E4%BB%A3%E7%90%86-SimAgent"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 模拟代理 (SimAgent)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%A8%A1%E6%8B%9F%E8%A1%8C%E5%8A%A8-SimAction"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 模拟行动 (SimAction)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E5%99%A8-ActionGenerator"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 行动生成器 (ActionGenerator)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">5. 服务器实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 架构概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%AB%AF%E7%82%B9%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 端点设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 HTTP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-WebSocket%E5%92%8CSocketIO"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 WebSocket和SocketIO</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        SAGA 面向代理的技能到行动生成框架
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Reinhart</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-05-24T05:41:25.000Z" itemprop="datePublished">2025-05-24</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/AI/" rel="tag">AI</a>, <a class="tag-link-link" href="/tags/NPC/" rel="tag">NPC</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="英文原文-Original-Text"><a href="#英文原文-Original-Text" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h1 id="Announcing-SAGA-Skill-to-Action-Generation-for-Agents"><a href="#Announcing-SAGA-Skill-to-Action-Generation-for-Agents" class="headerlink" title="Announcing SAGA: Skill to Action Generation for Agents."></a>Announcing SAGA: Skill to Action Generation for Agents.</h1><p>Demo Video of SAGA in Action</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Today, we are announcing SAGA: Skill to Action Generation for Agents, a generative AI framework that steers AI Agents toward successful goals through Actions. SAGA is inspired in part by Joon Park’s Generative Agents paper where Agents inhabit the 2D simulated town of Smallville. As well as the work on Voyager from Jim Fan, et al, in which Agents have a set of predefined Skills they can choose from but can also create new skills as they perform tasks in the 3D game, MineCraft.</p>
<p>You can <a href="https://github.com/fablestudio/fable-saga">find the code on GitHub</a>.</p>
<p>A Day in Thistle Gulch - Blackjack and Sheriff Cooper work to thwart each other’s plans</p>
<h2 id="中文翻译-Chinese-Translation"><a href="#中文翻译-Chinese-Translation" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h1 id="宣布SAGA：面向代理的技能到行动生成框架"><a href="#宣布SAGA：面向代理的技能到行动生成框架" class="headerlink" title="宣布SAGA：面向代理的技能到行动生成框架"></a>宣布SAGA：面向代理的技能到行动生成框架</h1><p>SAGA实际运行的演示视频</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>今天，我们宣布推出SAGA：面向代理的技能到行动生成框架（Skill to Action Generation for Agents），这是一个通过行动引导AI代理实现成功目标的生成式AI框架。SAGA的部分灵感来自Joon Park的生成式代理（Generative Agents）论文，该论文中的代理居住在名为Smallville的2D模拟小镇中。同时也受到Jim Fan等人开发的Voyager项目的启发，在该项目中，代理拥有一组预定义的技能可供选择，但也可以在执行3D游戏Minecraft中的任务时创建新技能。</p>
<p>您可以<a href="https://github.com/fablestudio/fable-saga">在GitHub上找到代码</a>。</p>
<p>蓟草峡谷的一天 - Blackjack和Sheriff Cooper努力阻挠彼此的计划</p>
<hr>
<h2 id="英文原文-Original-Text-1"><a href="#英文原文-Original-Text-1" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h3 id="Skills-in-Action"><a href="#Skills-in-Action" class="headerlink" title="Skills in Action"></a>Skills in Action</h3><p>With SAGA, Agents first tell SAGA contextual metadata about themselves and their world via a companion simulation: Who they are; What they know; What “Skills” they have; And what their goals are. Then, when an Agent is deciding what to do next, SAGA generates a set of “Actions” that best serve the Agent’s goals in that moment. These Action options are then scored and returned to the simulation in order to direct the Agent. This process repeats each time the Agent is deciding its next action and can be scaled to multiple agents running simultaneously.</p>
<p>An Action is just an implementation of a Skill as we will discuss. For now, think of Skills as a list of tools in a toolbox that the AI can employ in a specific way to advance a goal. For instance “Talk To” is a Skill, where an Agent can go talk to someone. If the Agent’s goal is to investigate a crime, then “Talk To <PERSON> about <TOPIC>“ forms a specific Action the Agent can then carry out.</p>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>Examples of how Skills become Actions</p>
<h2 id="中文翻译-Chinese-Translation-1"><a href="#中文翻译-Chinese-Translation-1" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h3 id="技能付诸行动"><a href="#技能付诸行动" class="headerlink" title="技能付诸行动"></a>技能付诸行动</h3><p>通过SAGA，代理首先通过配套模拟向SAGA提供关于自身和所处世界的上下文元数据：他们是谁；他们知道什么；他们拥有哪些”技能”；以及他们的目标是什么。然后，当代理决定下一步行动时，SAGA会生成一系列最能满足代理当前目标的”行动”。这些行动选项随后会被评分并返回给模拟系统，以指导代理。每当代理决定其下一步行动时，这个过程就会重复一次，并且可以扩展到多个同时运行的代理。</p>
<p>正如我们将讨论的，行动只是技能的一种实现。现在，可以将技能视为AI可以以特定方式使用的工具箱中的工具列表，以推进目标。例如，”与某人交谈”是一种技能，代理可以去与某人交谈。如果代理的目标是调查犯罪，那么”与&lt;某人&gt;谈论&lt;某话题&gt;”就形成了一个特定的行动，代理随后可以执行这个行动。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>技能如何转变为行动的示例</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523115938242.png" alt="image-20250523115938242"></p>
<hr>
<h2 id="英文原文-Original-Text-2"><a href="#英文原文-Original-Text-2" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="Pairing-With-a-Simulation"><a href="#Pairing-With-a-Simulation" class="headerlink" title="Pairing With a Simulation"></a>Pairing With a Simulation</h2><p>SAGA is B.Y.O.S.: Bring Your Own Simulation</p>
<p>SAGA is a B.Y.O.S. or Bring Your Own Simulation framework.</p>
<p>After responding with Action options, SAGA’s work is mostly done. It still receives information from the paired simulation it is connected to, but simulating the action itself, including generating conversations, or moving around an environment is left to the simulation to implement.</p>
<p>A set of starter Skills that leverage parts of our proprietary simulation (not currently publicly available) is provided, but other simulations, even very simple ones with only a few Skills, can be used as an alternative via the python library or by connecting to the framework over a network via its built-in socket-io server. See the Github repository for more information on documentation and integrating with your own simulation.</p>
<p>Using a preview of our Thistle Gulch simulation, let’s explore a more contextual example of how SAGA works in practice. Note that Thistle Gulch is still in development, so the details and visuals here are all subject to change. We will be announcing more about Thistle Gulch and “The Simulation” framework it’s built upon in the future.</p>
<h2 id="中文翻译-Chinese-Translation-2"><a href="#中文翻译-Chinese-Translation-2" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="与模拟系统配对"><a href="#与模拟系统配对" class="headerlink" title="与模拟系统配对"></a>与模拟系统配对</h2><p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120006872.png" alt="image-20250523120006872"></p>
<p>SAGA是B.Y.O.S.：自带模拟系统（Bring Your Own Simulation）</p>
<p>SAGA是一个B.Y.O.S.或自带模拟系统框架。</p>
<p>在响应行动选项后，SAGA的工作基本完成。它仍然接收来自所连接的配对模拟系统的信息，但模拟行动本身，包括生成对话或在环境中移动，都留给模拟系统来实现。</p>
<p>我们提供了一套利用我们专有模拟系统（目前尚未公开）部分功能的入门技能，但其他模拟系统，即使是只有少量技能的非常简单的系统，也可以通过Python库或通过网络连接到框架的内置socket-io服务器作为替代方案。有关文档和与您自己的模拟系统集成的更多信息，请参阅GitHub存储库。</p>
<p>使用我们的蓟草峡谷模拟预览版，让我们探索一个更具上下文的SAGA实际工作方式示例。请注意，蓟草峡谷仍在开发中，因此这里的细节和视觉效果都可能发生变化。我们将在未来宣布更多关于蓟草峡谷和它所基于的”The Simulation”框架的信息。</p>
<hr>
<h2 id="英文原文-Original-Text-3"><a href="#英文原文-Original-Text-3" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="Murder-in-Thistle-Gulch"><a href="#Murder-in-Thistle-Gulch" class="headerlink" title="Murder in Thistle Gulch"></a>Murder in Thistle Gulch</h2><p>Thistle Gulch is a simulation of a fictional 1800’s Wild-West Town by the same name. It’s currently inhabited by 17 or so characters, but we’ll mainly first focus on two of them.</p>
<h3 id="Personas"><a href="#Personas" class="headerlink" title="Personas"></a>Personas</h3><p>Let’s briefly explore Blackjack and Sheriff Cooper’s Personas. This is just a brief summary of their data. They also have detailed backstories and memories.</p>
<p>Blackjack vs Sheriff Cooper</p>
<h3 id="Meta-Memories"><a href="#Meta-Memories" class="headerlink" title="Meta-Memories"></a>Meta-Memories</h3><p>In order to generate Actions, the simulation needs to provide SAGA with relevant details we call “Meta-Memories”. These are the sum of all the relevant metadata surrounding the simulated world and its Agents. Some of this information will only be available to specific characters, like memories and observations. Other information is shared across characters like the locations, interactable objects, and summaries of other characters.</p>
<p>Meta-Memories are loaded just before the simulation starts or are streamed in while the simulation is running, as events unfold. This includes details about the activities other characters are performing, their conversations, and new memories that are formed as the simulation progresses.</p>
<h2 id="中文翻译-Chinese-Translation-3"><a href="#中文翻译-Chinese-Translation-3" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="蓟草峡谷中的谋杀案"><a href="#蓟草峡谷中的谋杀案" class="headerlink" title="蓟草峡谷中的谋杀案"></a>蓟草峡谷中的谋杀案</h2><p>蓟草峡谷是一个虚构的19世纪美国西部同名小镇的模拟。目前居住着约17个角色，但我们主要首先关注其中的两个。</p>
<h3 id="角色设定"><a href="#角色设定" class="headerlink" title="角色设定"></a>角色设定</h3><p>让我们简要探讨Blackjack和Sheriff Cooper的角色设定。这只是他们数据的简要总结。他们还有详细的背景故事和记忆。</p>
<p>Blackjack与Sheriff Cooper的对比</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120023216.png" alt="image-20250523120023216"></p>
<h3 id="元记忆"><a href="#元记忆" class="headerlink" title="元记忆"></a>元记忆</h3><p>为了生成行动，模拟系统需要向SAGA提供我们称为”元记忆”的相关细节。这些是围绕模拟世界及其代理的所有相关元数据的总和。某些信息只对特定角色可用，如记忆和观察结果。其他信息则在角色之间共享，如位置、可交互对象和其他角色的概述。</p>
<p>元记忆在模拟开始前加载，或者在模拟运行时随着事件的展开而流入。这包括其他角色正在执行的活动、他们的对话以及随着模拟进展而形成的新记忆等详细信息。</p>
<hr>
<h2 id="英文原文-Original-Text-4"><a href="#英文原文-Original-Text-4" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="The-Murder-Investigation"><a href="#The-Murder-Investigation" class="headerlink" title="The Murder Investigation"></a>The Murder Investigation</h2><p>The Sheriff considers what the evidence means</p>
<p>To test SAGA, we created an example scenario within Thistle Gulch where characters are forced to make choices about what to do next with clear and time sensitive goals, and constraints that confound those goals: The murder of a local native.</p>
<p>In our fictional scenario, a native from the local tribe was found dead just outside of town. The tribe’s chief has threatened to take things into his own hands if Sheriff Cooper doesn’t uncover the murderer quickly. Blackjack, the saloon owner and local gang leader, is also unsure who the murderer is, but he doesn’t want any investigation to blow back on him and ruin his plans to rob the stagecoach in a few weeks.</p>
<p>As the sun rises over Thistle Gulch on the start of Day 1, the Sheriff is standing next to the native’s remains and Blackjack is standing in his Saloon. Both are Agents and separately deciding what to do next via SAGA. The Meta-Memory of this 3 day window in which to solve the case encourages the characters to move forward in their own ways and achieve a timely conclusion.</p>
<h3 id="Sheriff-Cooper"><a href="#Sheriff-Cooper" class="headerlink" title="Sheriff Cooper"></a>Sheriff Cooper</h3><p>Sheriff Wyatt Cooper, choosing from the list of Actions provided by SAGA, first decides to do the “Search Near the Dead Native” Action, which uses his “interact” Skill. The “interact” Skill has access to a list of all interactable simulation objects and what interactions, often human authored, they afford the agent. Here, the generated Action becomes “<em>Interact with <Dead Native> and do the <Search Near the Dead Native> interaction that it provides</em>“.</p>
<p>After discovering blood and bullet casings during that interaction, SAGA uses yet another skill called “reflect”. The Action becomes “<em>Reflect on <The blood is fresh and there are bullet casings></em>“ where he decides to get to the bottom of this immediately, as seen in this conversation with himself within the Thistle Gulch UI.</p>
<h3 id="Saloon-Owner"><a href="#Saloon-Owner" class="headerlink" title="Saloon Owner"></a>Saloon Owner</h3><p>For Blackjack’s Agent, SAGA leverages the “Reflect” Skill to generate the “<em>Reflect on <Dead native situation affecting town stability></em>“ Action. He then resolves to steer the investigation’s outcome in a direction that benefits himself and his plans.</p>
<h2 id="中文翻译-Chinese-Translation-4"><a href="#中文翻译-Chinese-Translation-4" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="谋杀调查"><a href="#谋杀调查" class="headerlink" title="谋杀调查"></a>谋杀调查</h2><p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120107338.png" alt="image-20250523120107338"></p>
<p>警长思考证据的含义</p>
<p>为了测试SAGA，我们在蓟草峡谷中创建了一个示例场景，角色被迫在明确且时间敏感的目标下做出关于下一步行动的选择，同时面临阻碍这些目标的约束条件：一名当地原住民被谋杀的案件。</p>
<p>在我们的虚构场景中，一名来自当地部落的原住民在镇外被发现死亡。部落酋长威胁说，如果Sheriff Cooper不能迅速找出凶手，他将亲自处理此事。酒馆老板兼当地帮派头目Blackjack也不确定谁是凶手，但他不希望任何调查影响到他几周后抢劫马车的计划。</p>
<p>在第一天开始时，当太阳升起在蓟草峡谷上空，警长站在原住民遗体旁，而Blackjack则站在他的酒馆里。两人都是代理，通过SAGA分别决定下一步行动。关于这个3天时间窗口内解决案件的元记忆鼓励角色们以自己的方式前进并及时得出结论。</p>
<h3 id="Sheriff-Cooper-1"><a href="#Sheriff-Cooper-1" class="headerlink" title="Sheriff Cooper"></a>Sheriff Cooper</h3><p>Sheriff Wyatt Cooper从SAGA提供的行动列表中选择，首先决定执行”搜索死去的原住民附近”的行动，这使用了他的”交互”技能。”交互”技能可以访问所有可交互的模拟对象列表以及它们提供给代理的交互方式，这些交互方式通常是由人类编写的。在这里，生成的行动变成了”与&lt;死去的原住民&gt;交互并执行它提供的&lt;搜索死去的原住民附近&gt;交互”。</p>
<p>在那次交互中发现血迹和弹壳后，SAGA使用了另一个名为”反思”的技能。行动变成了”反思&lt;血迹新鲜且有弹壳&gt;”，他决定立即深入调查这个案件，正如在蓟草峡谷UI中与自己的对话所示。</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120133772.png" alt="image-20250523120133772"></p>
<h3 id="酒馆老板"><a href="#酒馆老板" class="headerlink" title="酒馆老板"></a>酒馆老板</h3><p>对于Blackjack的代理，SAGA利用”反思”技能生成了”反思&lt;死去原住民情况影响镇上稳定&gt;”的行动。然后他决定引导调查结果朝着有利于自己和计划的方向发展。</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120145045.png" alt="image-20250523120145045"></p>
<hr>
<h2 id="英文原文-Original-Text-5"><a href="#英文原文-Original-Text-5" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><p>After Blackjack is done Reflecting, he needs to decide what skill to use next and how to use that skill. A request is sent to SAGA which returns the following Actions. Each Action has an associated Skill, as shown by the different icons in the image below. As each Action is generated, a given Skill’s parameters are filled in by SAGA’s generative model.</p>
<p>Action options generated for Blackjack</p>
<h2 id="Cooperation-and-Conflict"><a href="#Cooperation-and-Conflict" class="headerlink" title="Cooperation and Conflict"></a>Cooperation and Conflict</h2><p>Blackjack and Sheriff Cooper are now in conflict with each other. The Sheriff wants to solve the crime, and Blackjack wants to make sure the investigation doesn’t ruin his plans. They continue to navigate this situation and pursue their disparate goals by generating and then choosing Actions via SAGA as the simulation progresses.</p>
<p>As both Agents are pursuing their own ends, they are also cooperating with other Agents. The Sheriff talks to the townsfolk looking for leads and cooperation, while Blackjack conspires with his gang to plant evidence and spread rumors to throw him off.</p>
<p>They may also manipulate the world and not just people to their own ends. The Sheriff will move the native’s body into the jail to preserve the evidence or Blackjack and his goons will find something incriminating and plant that evidence in the scapegoat’s room to frame them for the murder.</p>
<p>The Thistle Gulch demo video above shows Blackjack cooperating with his gang to draw the sheriff’s attention away from his criminal schemes. While the dialogue is generated by our Simulation, who to talk to and what the topic and goal of the conversations are all generated via SAGA.</p>
<p>The sheriff and Blackjack are both leveraging SAGA to generate candidate Actions, but here the Sheriff is choosing the option with the highest score automatically. Blackjack pauses when SAGA returns the options so we can see them all. The top option is the highest scoring and is the default choice, but they can also be chosen manually as shown in the video. The video has been edited for time and viewability, but the run wasn’t cherry-picked.</p>
<h2 id="中文翻译-Chinese-Translation-5"><a href="#中文翻译-Chinese-Translation-5" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><p>在Blackjack完成反思后，他需要决定下一步使用什么技能以及如何使用该技能。向SAGA发送请求，SAGA返回以下行动。每个行动都有一个相关联的技能，如下图中不同图标所示。随着每个行动的生成，SAGA的生成模型会填充给定技能的参数。</p>
<p>为Blackjack生成的行动选项</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120159076.png" alt="image-20250523120159076"></p>
<h2 id="合作与冲突"><a href="#合作与冲突" class="headerlink" title="合作与冲突"></a>合作与冲突</h2><p>Blackjack和Sheriff Cooper现在处于相互冲突状态。警长想要解决犯罪，而Blackjack想确保调查不会破坏他的计划。他们继续在这种情况下导航并通过SAGA生成和选择行动来追求各自不同的目标，随着模拟的进行。</p>
<p>当两个代理追求各自的目标时，他们也在与其他代理合作。警长与镇民交谈寻找线索和合作，而Blackjack则与他的帮派密谋栽赃和散布谣言以转移注意力。</p>
<p>他们也可能操纵世界而不仅仅是人。警长会将原住民的尸体移到监狱以保存证据，或者Blackjack和他的手下会找到一些罪证并将其栽赃到替罪羊的房间以嫁祸他们谋杀。</p>
<p>上面的蓟草峡谷演示视频显示Blackjack与他的帮派合作，将警长的注意力从他的犯罪计划上转移开。虽然对话是由我们的模拟系统生成的，但与谁交谈以及对话的主题和目标都是通过SAGA生成的。</p>
<p>警长和Blackjack都在利用SAGA生成候选行动，但在这里，警长自动选择得分最高的选项。Blackjack在SAGA返回选项时暂停，以便我们可以看到所有选项。最高选项是得分最高的，是默认选择，但它们也可以如视频所示手动选择。视频已经为了时间和可观看性而编辑，但运行并非精心挑选。</p>
<hr>
<h2 id="英文原文-Original-Text-6"><a href="#英文原文-Original-Text-6" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><p>Sheriff Cooper convinces Sally McCarty to betray Blackjack</p>
<p>While most of the time it goes somewhere useful, it can make connections or assumptions that turn out to be counter productive. For instance, even though the murder of the old Sheriff happened a year ago and the case has now gone cold, Wyatt may try to connect the native’s murder investigation back to that old case in a way that feels like he’s getting distracted. As someone with ADD, I know this can be realistic, but the audience will likely question that abrupt change in focus, and result in a less interesting narrative outcome.</p>
<p>The variation between different iterations of the simulation is based on the SAGA prompt and the LLM settings, but with so much contextual information available, the Agents reliably stay true to their characterization. The Action options that are generated, the scores of those actions, and then of course the simulation itself all have impacts that create the main opportunities for variation.</p>
<p>We often call this phenomenon “hallucination” on the part of the LLM, but Karpathy made a great point recently that, “hallucination is all LLMs do.” So, hallucination is not really the problem we need to solve, but the nature of the tool we’re using and “it’s greatest feature”. It’s up to us to best guide the model and handle the responses it provides us without locking it down so much that we don’t get what we actually want from it.</p>
<p>Andrej Karpathy Tweet on the “Hallucination Problem”</p>
<p>When using a robust simulation like ours, we take the responses that come back from SAGA and do additional validation on them like making sure they are using valid entities in their parameters before even considering them as options. We can also score options and even outcomes through multiple runs of the simulation to generate data for RLHF and fine-tune custom models on the behavior we want it to focus on next time.</p>
<h2 id="中文翻译-Chinese-Translation-6"><a href="#中文翻译-Chinese-Translation-6" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><p>Sheriff Cooper说服Sally McCarty背叛Blackjack</p>
<p><img src="D:\Document\typorapic\saga_translation_with_images\image-20250523120214260.png" alt="image-20250523120214260"></p>
<p>虽然大多数时候它会产生有用的结果，但它也可能做出不利于生产力的连接或假设。例如，即使旧警长的谋杀案发生在一年前，案件现已冷却，Wyatt可能会尝试将原住民谋杀调查与那个旧案件以一种看起来像是分心的方式联系起来。作为一个有注意力缺陷障碍的人，我知道这可能是现实的，但观众可能会质疑那种突然的焦点转变，并导致叙事结果不那么有趣。</p>
<p>模拟不同迭代之间的变化基于SAGA提示和LLM设置，但有了如此多的上下文信息，代理可靠地保持其特征。生成的行动选项、这些行动的分数，当然还有模拟本身都有影响，创造了变化的主要机会。</p>
<p>我们经常称这种现象为LLM的”幻觉”，但Karpathy最近指出，”幻觉是所有LLM都会做的事”。所以，幻觉并不是我们需要解决的问题，而是工具的本质和”它最大的特点”。我们的任务是最好地引导模型并处理它提供的响应，而不是过度限制它以至于我们无法从中获得我们真正想要的东西。</p>
<p>Andrej Karpathy关于”幻觉问题”的推文</p>
<p><img src="D:\Document\typorapic\saga_translation_with_images\image-20250523120224356.png" alt="image-20250523120224356"></p>
<p>当使用像我们这样的强大模拟系统时，我们会对从SAGA返回的响应进行额外验证，比如确保它们在参数中使用有效实体，然后才考虑它们作为选项。我们还可以通过模拟的多次运行对选项甚至结果进行评分，以生成RLHF数据并微调自定义模型，关注我们希望它下次关注的行为。</p>
<hr>
<h2 id="英文原文-Original-Text-7"><a href="#英文原文-Original-Text-7" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p>SAGA is leveraging a technique called “tool-use” popularized by the likes of AutoGPT and ChatGPT (Functions). Like these other projects, SAGA is a tool that builds upon the work of many others and shouldn’t be considered a research paper or fancy new model, but it does achieve very interesting results in a usable package for anyone to extend and experiment with.</p>
<p>In fact, the Skills definitions can be expanded to other domains like “Search The Web”, “Generate an Image”, or “Recall from Vector Database” if you like. Here, we are focusing on Actions that better match the simulation of human-like characters in a narrative context.</p>
<h2 id="AI-Planning-in-Context"><a href="#AI-Planning-in-Context" class="headerlink" title="AI Planning in Context"></a>AI Planning in Context</h2><p>Reinforcement Learning in which Agents leverage deep learning to play video games goes back a decade and more, but they have to learn how to play. With Large Language Models (LLMs), one simply has to provide contextual information, perhaps some examples, and then instruct the LLM to complete useful information to reach the goal. Of course this works best for domains where the LLM has seen representative training data, but in the case of human actions, this data is very common in the training set of the Web – we humans do like to talk about ourselves.</p>
<p>There is also a large space of work in what is generally called “AI Planning” which goes all the way back to the famous “Shakey the Robot” in the late 60s that could break a command down into individualized steps itself. Notably, “Shakey” research is where we get the A* algorithm and the Hough transform, a precursor to Convolutional Neural Nets. There is a lot of interest in using LLMs for Planning right now, be that in robotics, coding and more.</p>
<h2 id="中文翻译-Chinese-Translation-7"><a href="#中文翻译-Chinese-Translation-7" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h2><p>SAGA利用了一种称为”工具使用”的技术，这种技术由AutoGPT和ChatGPT（Functions）等项目普及。与这些其他项目一样，SAGA是一个建立在许多其他人工作基础上的工具，不应被视为研究论文或花哨的新模型，但它确实在一个可用的包中实现了非常有趣的结果，任何人都可以扩展和实验。</p>
<p>事实上，技能定义可以扩展到其他领域，如”搜索网络”、”生成图像”或”从向量数据库中召回”，如果你愿意的话。在这里，我们专注于更好地匹配在叙事上下文中模拟类人角色的行动。</p>
<h2 id="AI规划的上下文"><a href="#AI规划的上下文" class="headerlink" title="AI规划的上下文"></a>AI规划的上下文</h2><p>强化学习中代理利用深度学习玩视频游戏的历史可以追溯到十多年前，但它们必须学习如何玩游戏。使用大型语言模型（LLM），只需提供上下文信息，也许一些例子，然后指示LLM完成有用的信息以达到目标。当然，这对于LLM已经见过代表性训练数据的领域效果最好，但在人类行为的情况下，这些数据在网络的训练集中非常常见 - 我们人类喜欢谈论自己。</p>
<p>还有一大类被广泛称为”AI规划”的工作，可以追溯到60年代末著名的”Shakey机器人”，它可以将命令分解为自己的个性化步骤。值得注意的是，”Shakey”研究是我们获得A*算法和Hough变换的地方，后者是卷积神经网络的前身。现在在机器人、编码等领域使用LLM进行规划有很多兴趣。</p>
<hr>
<h2 id="英文原文-Original-Text-8"><a href="#英文原文-Original-Text-8" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="Language-Models-as-Zero-Shot-Planners"><a href="#Language-Models-as-Zero-Shot-Planners" class="headerlink" title="Language Models as Zero-Shot Planners"></a>Language Models as Zero-Shot Planners</h2><p>The closest analog for this work is probably the paper, <a href="https://arxiv.org/abs/2201.07207">“Language Models as Zero-Shot Planners: Extracting Actionable Knowledge for Embodied Agents”</a> from Huang and Abbeel in Jan 2022 that generated action plans for tasks like “Brush teeth”. There, they fine-tuned an LLM on “admissible actions” or actions that could actually be recognized by the VirtualHome simulator instead of just free-form instructions that the simulator wouldn’t recognize.</p>
<p>Diagram from Language Models as Zero-Shot Planners</p>
<p>Currently, SAGA doesn’t generate a whole action plan of small steps, instead it generates a list of candidate next-step-actions that are very high-level and parameterizable. This allows the Model to focus on a smaller set of high-level tools that it can apply in a multitude of ways instead of using lower-level or very specific steps to construct an action plan. This has benefits that fine-tuning isn’t necessary and allows the simulation to take on more of the burden of providing and executing the actions, saving time and money for those using a model like GPT-4.</p>
<h2 id="Generative-Human-like-Agents"><a href="#Generative-Human-like-Agents" class="headerlink" title="Generative Human-like Agents"></a>Generative Human-like Agents</h2><p>In 2023, a lot of additional work has been done in this space, but we will highlight two for now that were also inspirational for how SAGA is architected, the terminology, and getting SAGA released. How SAGA may take a different approach than these projects is also highlighted.</p>
<p>Diagram from Generative Agents Paper</p>
<p><a href="https://arxiv.org/abs/2304.03442">Generative Agents: Interactive Simulacra of Human Behavior</a>, Park, et al Apr 2023. Here, Joon created a simple simulation in the browser using a 2D-grid game engine backed by a Python webserver. It also has another Python server running the code that drives the agents. The two communicate by saving a series of specially named files containing either the simulation data (locations of the agents in space), or what actions the agents should take in this step. All agents are evaluated each step and there is interesting work that explores observations, daily planning, and vector database storage&#x2F;retrieval of memories.</p>
<p>Outside of research, that architecture makes it difficult to make use of in practice. The lock-step approach also takes a long time between steps and with the complex LLM re-processing overhead <a href="https://twitter.com/goodside/status/1645129328681115648">it can be very expensive to run</a> for someone just looking to experiment.</p>
<h2 id="中文翻译-Chinese-Translation-8"><a href="#中文翻译-Chinese-Translation-8" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="作为零样本规划器的语言模型"><a href="#作为零样本规划器的语言模型" class="headerlink" title="作为零样本规划器的语言模型"></a>作为零样本规划器的语言模型</h2><p>这项工作最接近的类比可能是这篇论文，<a href="https://arxiv.org/abs/2201.07207">“Language Models as Zero-Shot Planners: Extracting Actionable Knowledge for Embodied Agents”</a>，由Huang和Abbeel于2022年1月发表，该论文为”刷牙”等任务生成行动计划。在那里，他们对LLM进行了微调，使其能够识别”可接受的行动”，即VirtualHome模拟器可以实际识别的行动，而不是模拟器无法识别的自由形式指令。</p>
<p>来自《作为零样本规划器的语言模型》的图表</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120244409.png" alt="image-20250523120244409"></p>
<p>目前，SAGA不生成由小步骤组成的完整行动计划，而是生成一个可参数化的高级候选下一步行动列表。这允许模型专注于一组更小的高级工具，它可以以多种方式应用，而不是使用低级或非常具体的步骤构建行动计划。这有好处，不需要微调，并允许模拟承担更多提供和执行行动的负担，为使用像GPT-4这样的模型的人节省时间和金钱。</p>
<h2 id="生成式类人代理"><a href="#生成式类人代理" class="headerlink" title="生成式类人代理"></a>生成式类人代理</h2><p>2023年，在这个领域已经完成了大量额外的工作，但我们现在将重点介绍两个对SAGA的架构、术语和发布有启发作用的项目。SAGA可能采取与这些项目不同的方法，这一点也被强调。</p>
<p>来自生成式代理论文的图表</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120256805.png" alt="image-20250523120256805"></p>
<p><a href="https://arxiv.org/abs/2304.03442">Generative Agents: Interactive Simulacra of Human Behavior</a>，Park等人，2023年4月。在这里，Joon创建了一个在浏览器中使用2D网格游戏引擎的简单模拟，由Python网络服务器支持。它还有另一个运行驱动代理代码的Python服务器。两者通过保存包含模拟数据（代理在空间中的位置）或代理在此步骤中应采取的行动的特殊命名文件进行通信。所有代理在每一步都被评估，有一些有趣的工作探索观察、日常规划和向量数据库存储&#x2F;检索记忆。</p>
<p>在研究之外，这种架构使其难以实际使用。锁步方法也需要在步骤之间花费很长时间，并且由于复杂的LLM重新处理开销，<a href="https://twitter.com/goodside/status/1645129328681115648">运行可能非常昂贵</a>，对于只想实验的人来说。</p>
<hr>
<h2 id="英文原文-Original-Text-9"><a href="#英文原文-Original-Text-9" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><p>SAGA takes a different approach. It’s available via socket.io so it communicates asynchronously over the web or on a local network. That means Agents and the Simulation don’t need to pause the world while waiting for Actions to be generated, though you can still do that if you like. It also provides a cleaner abstraction between the simulation and what is generating actions. SAGA does the generation based on requests for Actions, and the simulation is free to interpret those actions as it needs.</p>
<h2 id="Interacting-With-and-Planning-in-a-3D-World"><a href="#Interacting-With-and-Planning-in-a-3D-World" class="headerlink" title="Interacting With and Planning in a 3D World"></a>Interacting With and Planning in a 3D World</h2><p>Diagram from Voyager Paper</p>
<p><a href="https://arxiv.org/abs/2305.16291">Voyager: An Open-Ended Embodied Agent with LLMs</a> - Jim Fan’s team May 2023. Shortly after “Generative Agents” in 2023 we got “Voyager”, a follow up to Fan’s Team’s “MineDojo” paper and tool of the same name from 2022. Together, they provide an open 3D world by connecting to the popular game MineCraft. MineCraft is the simulation environment and Voyager connects to it via an API that bridges the two called “MineFlayer”. There are no plans to connect SAGA to Minecraft, but pull requests are welcome!</p>
<p>Voyager also goes beyond the current scope of SAGA as it’s a research project focused on “Life-long learning” and creating new skills via code generation and refinement while essentially leveling the Agent up in Minecraft and learning to craft new things along the way.</p>
<p>However, Minecraft is a pretty limited simulator for human-like experiences, especially with multiple agents in dialog with each other. Thistle Gulch is mostly concerned with narrative outcomes, so we prioritize Actions that match the Agent’s personality, history, memory and relationships. Our Agents, Blackjack and the Sheriff, are also characters in a Narrative, so we want them to perform their narrative roles and achieve satisfying narrative outcomes as well.</p>
<h2 id="中文翻译-Chinese-Translation-9"><a href="#中文翻译-Chinese-Translation-9" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><p>SAGA采取了不同的方法。它通过socket.io可用，因此它通过网络或在本地网络上异步通信。这意味着代理和模拟不需要在等待生成行动时暂停世界，尽管如果你愿意，你仍然可以这样做。它还提供了模拟和生成行动之间更清晰的抽象。SAGA基于行动请求进行生成，模拟系统可以根据需要自由解释这些行动。</p>
<h2 id="在3D世界中交互和规划"><a href="#在3D世界中交互和规划" class="headerlink" title="在3D世界中交互和规划"></a>在3D世界中交互和规划</h2><p>来自Voyager论文的图表</p>
<p><img src="https://raw.githubusercontent.com/reinhart-l/FigureBed3/master/image-20250523120423179.png" alt="image-20250523120423179"></p>
<p><a href="https://arxiv.org/abs/2305.16291">Voyager: An Open-Ended Embodied Agent with LLMs</a> - Jim Fan的团队，2023年5月。在2023年”Generative Agents”之后不久，我们得到了”Voyager”，这是对Fan的团队2022年的”MineDojo”论文和同名工具的后续。它们共同提供了一个开放的3D世界，通过连接到流行游戏Minecraft。Minecraft是模拟环境，Voyager通过一个名为”MineFlayer”的API桥接连接到它。目前没有计划将SAGA连接到Minecraft，但欢迎提出请求！</p>
<p>Voyager还超出了SAGA的当前范围，因为它是一个专注于”终身学习”和通过代码生成和改进创建新技能的研究项目，同时本质上在Minecraft中提升代理的等级并学习制作新物品。</p>
<p>然而，Minecraft作为人类般体验的模拟器相当有限，特别是在多个代理相互对话的情况下。蓟草峡谷主要关注叙事结果，因此我们优先考虑与代理的个性、历史、记忆和关系相匹配的行动。我们的代理，Blackjack和警长，也是叙事中的角色，所以我们希望他们执行其叙事角色并实现令人满意的叙事结果。</p>
<hr>
<h2 id="英文原文-Original-Text-10"><a href="#英文原文-Original-Text-10" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="Next-Steps"><a href="#Next-Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>What’s next for SAGA and where do we see it headed? As a v1 release, SAGA is functional but we will continue to support and improve it over time while looking to grow a community interested in it and its applications.</p>
<h2 id="Challenges-for-Production-Use"><a href="#Challenges-for-Production-Use" class="headerlink" title="Challenges for Production Use"></a>Challenges for Production Use</h2><h3 id="Generation-Times"><a href="#Generation-Times" class="headerlink" title="Generation Times"></a>Generation Times</h3><p>Right now, Generation on the latest GPT-3.5 takes around 3 seconds for 5 Action options, and GPT-4 takes around 30 seconds. The generation time is directly related to the number of generated tokens, not the input prompt so SAGA users should experiment which model and the number of options they actually need in their own context. Right now, this generation of options happens in one LLM request which optimizes input token costs, but it can be parallelized instead. For our demo video, we paused the world while waiting for options to generate and then cut that for time. SAGA already parallelizes the per-character requests so the number of characters doesn’t directly affect the wall-clock generation time.</p>
<h3 id="Memory-and-Prompt-Size-Limits"><a href="#Memory-and-Prompt-Size-Limits" class="headerlink" title="Memory and Prompt Size Limits"></a>Memory and Prompt Size Limits</h3><p>SAGA keeps the memory model simple at this point, using lists and dictionaries in memory to index and retrieve the records provided by the simulation. Using LLMs with larger prompts and limiting the metadata to recent or important events is a way to expand the amount of Meta-Memories possible without hitting model context window limits. The latest GPT-4 OpenAI models have a 128K token limit now, nearly 100x larger than it was a few years ago.</p>
<p>To increase the number of Meta-Memories, say to increase the number of characters in the world, their relationships, their individual knowledge, and their memories of events, more complex storage and retrieval techniques are needed. Generation of embeddings to store and retrieve Meta-Memories with Vector DBs like FAISS, knowledge graphs, or even SQL databases to preserve memories are useful techniques to explore, but needs will vary and engineering is all about tradeoffs so we leave those to the user for now.</p>
<h2 id="中文翻译-Chinese-Translation-10"><a href="#中文翻译-Chinese-Translation-10" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h2><p>SAGA的下一步是什么，我们认为它将走向何方？作为v1版本，SAGA是功能性的，但我们将继续支持并随着时间改进它，同时寻求建立一个对它及其应用感兴趣的社区。</p>
<h2 id="生产使用的挑战"><a href="#生产使用的挑战" class="headerlink" title="生产使用的挑战"></a>生产使用的挑战</h2><h3 id="生成时间"><a href="#生成时间" class="headerlink" title="生成时间"></a>生成时间</h3><p>目前，在最新的GPT-3.5上生成大约需要3秒钟生成5个行动选项，而GPT-4需要大约30秒。生成时间与生成的令牌数量直接相关，而不是输入提示，因此SAGA用户应该实验哪种模型以及在自己的上下文中实际需要的选项数量。目前，这种选项生成发生在一个LLM请求中，这优化了输入令牌成本，但它也可以并行化。对于我们的演示视频，我们在等待选项生成时暂停了世界，然后为了节省时间而剪辑了视频。SAGA已经并行化了每个角色的请求，因此角色数量不会直接影响挂钟生成时间。</p>
<h3 id="内存和提示大小限制"><a href="#内存和提示大小限制" class="headerlink" title="内存和提示大小限制"></a>内存和提示大小限制</h3><p>SAGA目前保持内存模型简单，使用内存中的列表和字典来索引和检索模拟提供的记录。使用具有更大提示和限制元数据到最近或重要事件的LLM是扩展可能的元记忆量而不触及模型上下文窗口限制的一种方法。最新的GPT-4 OpenAI模型现在有128K令牌限制，几乎比几年前大100倍。</p>
<p>要增加元记忆的数量，比如增加世界中的角色数量、它们的关系、它们的个人知识以及它们对事件的记忆，需要更复杂的存储和检索技术。生成嵌入以存储和检索带有向量数据库（如FAISS）、知识图或甚至SQL数据库的元记忆是值得探索的有用技术，但需求会有所不同，工程都是关于权衡的，所以我们暂时将这些留给用户。</p>
<hr>
<h2 id="英文原文-Original-Text-11"><a href="#英文原文-Original-Text-11" class="headerlink" title="英文原文 (Original Text)"></a>英文原文 (Original Text)</h2><h2 id="SAGA’s-Future-Goals"><a href="#SAGA’s-Future-Goals" class="headerlink" title="SAGA’s Future Goals"></a>SAGA’s Future Goals</h2><p>As the goal of SAGA is steering AI Agents toward successful goals through Actions, the next logical step is to improve those generated Actions. There’s a number of exciting research areas exploring this space lately.</p>
<p>For instance, SAGA already uses a “test-time compute” tradeoff technique of generating multiple candidate options and then validating and scoring the answers before choosing the best one as a way to get much better results without training a custom model. Related techniques include “Chain-of-thought” and “Tree-of-thought” or search based techniques used in AlphaGo where a model is trained to predict how good an option is likely to be through self-play.</p>
<p>Improving the Skills (the tools the model has to choose from) also increases the quality of the Actions. For instance, we are working on the “exchange” skill that allows characters to buy, sell, steal, and give items in their inventory. Creating new Skills via code generation like Voyager does, or at least chaining together existing skills to form action-plans is an exciting area of research as well.</p>
<p>Since SAGA doesn’t ship with a simulation out of the box in order to get started, we will be looking to add a simple text-based simulation to quickly test it out, but we think it’s important to keep the simulation itself separate from SAGA in order to be sim-agnostic. We will be looking for others who want to build their own simulation or use it with existing open source simulators and expect to see rapid support for simple 2D simulations that appeared after the Generate Agents paper.</p>
<p>Other simulations will have Agents within Gaming or Reinforcement Learning scenarios. Some simulations are engaged in RPG combat like the Neurips MMO Challenge happening this week. We’re excited to build upon SAGA, but also excited to see how the community uses it and contributes back. <a href="https://github.com/fablestudio/fable-saga">Check out the GitHub repo for more information</a>.</p>
<p>[AI] · [Simulations] · [Agents] · [Tool-Use]</p>
<p>[Previous Previous Thistle Gulch Simulation Beta Op…]</p>
<p>[Next Next SAGA Now Available: Open Source]</p>
<h2 id="中文翻译-Chinese-Translation-11"><a href="#中文翻译-Chinese-Translation-11" class="headerlink" title="中文翻译 (Chinese Translation)"></a>中文翻译 (Chinese Translation)</h2><h2 id="SAGA的未来目标"><a href="#SAGA的未来目标" class="headerlink" title="SAGA的未来目标"></a>SAGA的未来目标</h2><p>由于SAGA的目标是通过行动引导AI代理实现成功目标，下一个合乎逻辑的步骤是改进这些生成的行动。最近有许多令人兴奋的研究领域在探索这个空间。</p>
<p>例如，SAGA已经使用”测试时计算”权衡技术，生成多个候选选项，然后在选择最佳选项之前验证和评分答案，作为一种在不训练自定义模型的情况下获得更好结果的方法。相关技术包括”思维链”和”思维树”或基于搜索的技术，用于AlphaGo，其中模型被训练预测通过自我对弈选项可能有多好。</p>
<p>改进技能（模型可以选择的工具）也会提高行动的质量。例如，我们正在开发”交换”技能，允许角色在其库存中购买、出售、偷窃和赠送物品。像Voyager那样通过代码生成创建新技能，或者至少将现有技能链接在一起形成行动计划，是一个令人兴奋的研究领域。</p>
<p>由于SAGA没有附带开箱即用的模拟系统，为了快速测试，我们将寻求添加一个简单的基于文本的模拟系统，但我们认为保持模拟系统本身与SAGA分离以保持模拟不可知性很重要。我们将寻找希望构建自己的模拟系统或将其与现有开源模拟器一起使用的人，并期望看到对Generative Agents论文之后出现的简单2D模拟的快速支持。</p>
<p>其他模拟将在游戏或强化学习场景中拥有代理。一些模拟参与RPG战斗，如本周进行的Neurips MMO挑战赛。我们很高兴在SAGA的基础上构建，但也很高兴看到社区如何使用它并做出贡献。<a href="https://github.com/fablestudio/fable-saga">查看GitHub仓库了解更多信息</a>。</p>
<p>[AI] · [Simulations] · [Agents] · [Tool-Use]</p>
<p>[Previous Previous Thistle Gulch Simulation Beta Op…]</p>
<p>[Next Next SAGA Now Available: Open Source]</p>
<h1 id="SAGA项目代码流程详细解析"><a href="#SAGA项目代码流程详细解析" class="headerlink" title="SAGA项目代码流程详细解析"></a>SAGA项目代码流程详细解析</h1><h2 id="1-SAGA核心架构与组件"><a href="#1-SAGA核心架构与组件" class="headerlink" title="1. SAGA核心架构与组件"></a>1. SAGA核心架构与组件</h2><p>SAGA框架的核心组件构成了一个层次化的架构，以实现AI代理行动生成的功能。</p>
<h3 id="1-1-主要组件概述"><a href="#1-1-主要组件概述" class="headerlink" title="1.1 主要组件概述"></a>1.1 主要组件概述</h3><p>SAGA的核心架构由以下几个主要组件构成：</p>
<ol>
<li><strong>BaseSagaAgent</strong>: 所有代理的基类，提供了与语言模型交互的基础设施。</li>
<li><strong>ActionsAgent</strong>: 负责根据上下文和技能生成行动选项。</li>
<li><strong>ConversationAgent</strong>: 负责生成角色之间的对话。</li>
<li><strong>EmbeddingAgent</strong>: 负责生成文本嵌入，用于记忆检索和相似度匹配。</li>
</ol>
<h3 id="1-2-核心组件详解"><a href="#1-2-核心组件详解" class="headerlink" title="1.2 核心组件详解"></a>1.2 核心组件详解</h3><p>下面是主要组件的关系图：</p>
<pre class="mermaid">classDiagram
    class BaseSagaAgent {
        +prompt_template
        +callback_handler
        +_llm
        +generate_chain()
    }
    
    class ActionsAgent {
        +guidance
        +generate_actions()
    }
    
    class ConversationAgent {
        +generate_conversation()
    }
    
    class EmbeddingAgent {
        +embed_documents()
        +embed_query()
        +store_documents()
        +find_similar()
    }
    
    class Skill {
        +name
        +description
        +parameters
    }
    
    class Action {
        +skill
        +parameters
    }
    
    class GeneratedActions {
        +options
        +scores
        +raw_prompt
        +raw_response
        +llm_info
        +sort()
    }
    
    BaseSagaAgent <|-- ActionsAgent
    BaseSagaAgent <|-- ConversationAgent
    ActionsAgent ..> Skill
    ActionsAgent ..> GeneratedActions
    GeneratedActions o-- Action</pre>

<h4 id="1-2-1-BaseSagaAgent"><a href="#1-2-1-BaseSagaAgent" class="headerlink" title="1.2.1 BaseSagaAgent"></a>1.2.1 BaseSagaAgent</h4><p><code>BaseSagaAgent</code>是所有SAGA代理的基类，它提供了与语言模型交互的基础设施：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, prompt_template: BasePromptTemplate, llm: <span class="type">Optional</span>[BaseLanguageModel] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># 设置回调处理器</span></span><br><span class="line">    self.callback_handler = SagaCallbackHandler(...)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 如果没有提供语言模型，使用默认的OpenAI模型</span></span><br><span class="line">    <span class="keyword">if</span> llm <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        self._llm = llm</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self._llm = ChatOpenAI(...)</span><br><span class="line">    </span><br><span class="line">    self.prompt_template = prompt_template</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_chain</span>(<span class="params">self</span>) -&gt; LLMChain:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;生成用于代理的LLMChain&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> LLMChain(llm=self._llm, prompt=self.prompt_template)</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-ActionsAgent"><a href="#1-2-2-ActionsAgent" class="headerlink" title="1.2.2 ActionsAgent"></a>1.2.2 ActionsAgent</h4><p><code>ActionsAgent</code>继承自<code>BaseSagaAgent</code>，专门负责生成行动选项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm: <span class="type">Optional</span>[BaseLanguageModel] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__(</span><br><span class="line">        prompt_template=load_prompt(<span class="string">&quot;generate_actions.yaml&quot;</span>),</span><br><span class="line">        llm=llm,</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提供给模型的指导，帮助生成更好的行动</span></span><br><span class="line">    self.guidance = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        * 提供目标和行动</span></span><br><span class="line"><span class="string">        * 不要创造新角色</span></span><br><span class="line"><span class="string">        * 保持角色个性和环境一致性</span></span><br><span class="line"><span class="string">        * 使用观察和对话来指导行动</span></span><br><span class="line"><span class="string">        * 只使用提供的技能</span></span><br><span class="line"><span class="string">        * 避免重复相同的行动</span></span><br><span class="line"><span class="string">        * 通过行动推进故事</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_actions</span>(<span class="params">self, context: <span class="built_in">str</span>, skills: <span class="type">List</span>[Skill], max_tries=<span class="number">0</span>, verbose=<span class="literal">False</span></span>) -&gt; GeneratedActions:</span><br><span class="line">    <span class="comment"># 检查输入</span></span><br><span class="line">    <span class="keyword">assert</span> context <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">len</span>(context) &gt; <span class="number">0</span>, <span class="string">&quot;Must provide a context.&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> skills <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">len</span>(skills) &gt; <span class="number">0</span>, <span class="string">&quot;Must provide at least one skill.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建Chain</span></span><br><span class="line">    chain = self.generate_chain()</span><br><span class="line">    chain.verbose = verbose</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 将技能转换为JSON</span></span><br><span class="line">    dumped_skills = [unstructure(skill) <span class="keyword">for</span> skill <span class="keyword">in</span> skills]</span><br><span class="line">    json_skills = json.dumps(dumped_skills)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试生成行动</span></span><br><span class="line">    retries = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> retries &lt;= max_tries:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 调用语言模型</span></span><br><span class="line">            response = <span class="keyword">await</span> chain.ainvoke(</span><br><span class="line">                &#123;<span class="string">&quot;context&quot;</span>: context, <span class="string">&quot;skills&quot;</span>: json_skills&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;callbacks&quot;</span>: [self.callback_handler]&#125;,</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 解析响应</span></span><br><span class="line">            raw_response = response.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            raw_actions = json.loads(raw_response)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 构建GeneratedActions对象</span></span><br><span class="line">            actions = structure(raw_actions, GeneratedActions)</span><br><span class="line">            actions.raw_prompt = self.callback_handler.last_prompt</span><br><span class="line">            actions.raw_response = raw_actions</span><br><span class="line">            actions.llm_info = self.callback_handler.last_model_info</span><br><span class="line">            actions.retries = retries</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 排序并返回</span></span><br><span class="line">            actions.sort()</span><br><span class="line">            <span class="keyword">return</span> actions</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 处理错误，准备重试</span></span><br><span class="line">            last_error = <span class="built_in">str</span>(e)</span><br><span class="line">        retries += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 所有尝试都失败</span></span><br><span class="line">    <span class="keyword">return</span> GeneratedActions(</span><br><span class="line">        options=[],</span><br><span class="line">        scores=[],</span><br><span class="line">        retries=retries,</span><br><span class="line">        error=<span class="string">f&quot;No options found after <span class="subst">&#123;retries&#125;</span> retries.&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-ConversationAgent"><a href="#1-2-3-ConversationAgent" class="headerlink" title="1.2.3 ConversationAgent"></a>1.2.3 ConversationAgent</h4><p><code>ConversationAgent</code>也继承自<code>BaseSagaAgent</code>，专门用于生成角色之间的对话：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, llm: <span class="type">Optional</span>[BaseLanguageModel] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="built_in">super</span>().__init__(</span><br><span class="line">        prompt_template=load_prompt(<span class="string">&quot;generate_conversation.yaml&quot;</span>),</span><br><span class="line">        llm=llm,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_conversation</span>(<span class="params">self, persona_guids: <span class="type">List</span>[<span class="built_in">str</span>], context: <span class="built_in">str</span>, max_tries=<span class="number">0</span>, verbose=<span class="literal">False</span></span>) -&gt; GeneratedConversation:</span><br><span class="line">    <span class="comment"># 检查输入</span></span><br><span class="line">    <span class="keyword">assert</span> persona_guids <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">len</span>(persona_guids) &gt; <span class="number">0</span>, <span class="string">&quot;Must provide at least one persona_guid.&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> context <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">len</span>(context) &gt; <span class="number">0</span>, <span class="string">&quot;Must provide a context.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建Chain</span></span><br><span class="line">    chain = self.generate_chain()</span><br><span class="line">    chain.verbose = verbose</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 格式化角色ID</span></span><br><span class="line">    formatted_persona_guids = <span class="string">&quot;[&quot;</span> + <span class="string">&quot;, &quot;</span>.join(persona_guids) + <span class="string">&quot;]&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试生成对话</span></span><br><span class="line">    retries = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> retries &lt;= max_tries:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 调用语言模型</span></span><br><span class="line">            response = <span class="keyword">await</span> chain.ainvoke(</span><br><span class="line">                &#123;<span class="string">&quot;context&quot;</span>: context, <span class="string">&quot;persona_guids&quot;</span>: formatted_persona_guids&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;callbacks&quot;</span>: [self.callback_handler]&#125;,</span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 解析响应</span></span><br><span class="line">            raw_response = response.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            raw_conversation = json.loads(raw_response)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 构建GeneratedConversation对象</span></span><br><span class="line">            conversation = structure(raw_conversation, GeneratedConversation)</span><br><span class="line">            conversation.raw_prompt = self.callback_handler.last_prompt</span><br><span class="line">            conversation.raw_response = raw_response</span><br><span class="line">            conversation.llm_info = self.callback_handler.last_model_info</span><br><span class="line">            conversation.retries = retries</span><br><span class="line">            <span class="keyword">return</span> conversation</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># 处理错误，准备重试</span></span><br><span class="line">            last_error = <span class="built_in">str</span>(e)</span><br><span class="line">        retries += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 所有尝试都失败</span></span><br><span class="line">    <span class="keyword">return</span> GeneratedConversation(</span><br><span class="line">        conversation=[],</span><br><span class="line">        retries=retries,</span><br><span class="line">        error=<span class="string">f&quot;No options found after <span class="subst">&#123;retries&#125;</span> retries.&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-EmbeddingAgent"><a href="#1-2-4-EmbeddingAgent" class="headerlink" title="1.2.4 EmbeddingAgent"></a>1.2.4 EmbeddingAgent</h4><p><code>EmbeddingAgent</code>负责生成文本嵌入并与向量数据库交互（更多细节见章节3）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EmbeddingAgent</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        embeddings: <span class="type">Optional</span>[Embeddings] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        storage: <span class="type">Optional</span>[VectorStore] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="comment"># 初始化嵌入模型和存储</span></span><br><span class="line">        <span class="keyword">if</span> embeddings <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">from</span> langchain_openai <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line">            <span class="keyword">except</span> ImportError:</span><br><span class="line">                <span class="keyword">raise</span> ImportError(</span><br><span class="line">                    <span class="string">&quot;OpenAI not installed. Please install langchain-openai or provide embeddings.&quot;</span></span><br><span class="line">                )</span><br><span class="line">            self.embeddings = OpenAIEmbeddings(</span><br><span class="line">                model=default_openai_embedding_model_name</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.embeddings = embeddings</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> storage <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.storage = SimpleVectorStore(embedding_model=self.embeddings)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.storage = storage</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">embed_documents</span>(<span class="params">self, texts: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">float</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;为文档生成嵌入&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.embeddings.embed_documents(texts)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">store_documents</span>(<span class="params">self, docs: <span class="type">List</span>[Document]</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;存储文档到向量数据库&quot;&quot;&quot;</span></span><br><span class="line">        texts = [doc.text <span class="keyword">for</span> doc <span class="keyword">in</span> docs]</span><br><span class="line">        metadatas = [doc.metadata <span class="keyword">for</span> doc <span class="keyword">in</span> docs]</span><br><span class="line">        <span class="keyword">return</span> self.storage.add_texts(texts, metadatas=metadatas)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">find_similar</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">5</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="type">Tuple</span>[Document, <span class="built_in">float</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;查找与查询相似的文档&quot;&quot;&quot;</span></span><br><span class="line">        results = self.storage.similarity_search_with_score(query, k)</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            (Document.from_langchain(doc), score) <span class="keyword">for</span> doc, score <span class="keyword">in</span> results</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>

<h3 id="1-3-关键数据结构"><a href="#1-3-关键数据结构" class="headerlink" title="1.3 关键数据结构"></a>1.3 关键数据结构</h3><p>SAGA框架中使用的一些关键数据结构：</p>
<ul>
<li><p><strong>Skill</strong>: 代表代理可以执行的技能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># class Skill:</span></span><br><span class="line"><span class="comment">#     +name</span></span><br><span class="line"><span class="comment">#     +description</span></span><br><span class="line"><span class="comment">#     +parameters</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Action</strong>: 代表一个被选定执行的具体技能和其参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># class Action:</span></span><br><span class="line"><span class="comment">#     +skill</span></span><br><span class="line"><span class="comment">#     +parameters</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>GeneratedActions</strong>: 包含由<code>ActionsAgent</code>生成的行动选项列表及其相关信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@define(<span class="params">slots=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GeneratedActions</span>:</span><br><span class="line">    options: <span class="type">List</span>[Action]</span><br><span class="line">    scores: <span class="type">List</span>[<span class="built_in">float</span>]</span><br><span class="line">    raw_prompt: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    raw_response: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    llm_info: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = <span class="literal">None</span></span><br><span class="line">    retries: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    error: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sort</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;按分数排序行动选项&quot;&quot;&quot;</span></span><br><span class="line">        self.options = [</span><br><span class="line">            x</span><br><span class="line">            <span class="keyword">for</span> _, x <span class="keyword">in</span> <span class="built_in">sorted</span>(</span><br><span class="line">                <span class="built_in">zip</span>(self.scores, self.options), key=<span class="keyword">lambda</span> pair: pair[<span class="number">0</span>], reverse=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line">        ]</span><br><span class="line">        self.scores = <span class="built_in">sorted</span>(self.scores, reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-核心工作流程"><a href="#2-核心工作流程" class="headerlink" title="2. 核心工作流程"></a>2. 核心工作流程</h2><p>SAGA的主要工作流程涉及环境交互、行动生成、行动执行、对话生成和记忆管理。</p>
<h3 id="2-1-总体流程"><a href="#2-1-总体流程" class="headerlink" title="2.1 总体流程"></a>2.1 总体流程</h3><p>SAGA的主要工作流程可以用以下流程图表示：</p>
<pre class="mermaid">graph TD
    A[模拟环境] -->|提供上下文和技能| B[ActionsAgent]
    B -->|生成行动选项| C[行动选项]
    C -->|选择执行| D[SimAction]
    D -->|更新环境和记忆| A
    A -->|提供对话角色和上下文| E[ConversationAgent]
    E -->|生成对话| F[对话内容]
    F -->|更新记忆| A
    A -->|提供记忆查询| G[EmbeddingAgent]
    G -->|检索相关记忆| A</pre>

<h3 id="2-2-详细执行流程概述"><a href="#2-2-详细执行流程概述" class="headerlink" title="2.2 详细执行流程概述"></a>2.2 详细执行流程概述</h3><ol>
<li><strong>初始化阶段</strong>:<ul>
<li>加载模拟环境（如Space Colony示例）。</li>
<li>初始化各种代理（<code>ActionsAgent</code>, <code>ConversationAgent</code>等）。</li>
<li>加载技能定义、角色、位置等元数据。</li>
</ul>
</li>
<li><strong>行动生成流程</strong>:<ul>
<li>模拟环境调用<code>ActionsAgent.generate_actions()</code>。</li>
<li>该方法接收上下文（包含角色信息、记忆等）和可用技能列表。</li>
<li>构建提示(prompt)，发送给LLM。</li>
<li>LLM返回JSON格式的行动选项，每个选项包含一个技能名和参数。</li>
<li>将选项解析为<code>GeneratedActions</code>对象并按分数排序。</li>
<li>返回排序后的行动选项供模拟环境使用。</li>
</ul>
</li>
<li><strong>行动执行流程</strong>:<ul>
<li>模拟环境选择一个行动选项。</li>
<li>创建对应的<code>SimAction</code>子类实例。</li>
<li>调用该实例的<code>tick()</code>方法随时间推进行动。</li>
<li>行动完成时，更新角色的记忆和状态。</li>
</ul>
</li>
<li><strong>对话生成流程</strong>:<ul>
<li>当角色需要交谈时，调用<code>ConversationAgent.generate_conversation()</code>。</li>
<li>该方法接收参与对话的角色ID和上下文。</li>
<li>构建提示，发送给LLM。</li>
<li>LLM返回JSON格式的对话内容。</li>
<li>将对话内容保存为角色的记忆。</li>
</ul>
</li>
<li><strong>记忆检索流程</strong>:<ul>
<li>使用<code>EmbeddingAgent</code>将文本转换为向量嵌入。</li>
<li>存储记忆文档及其嵌入到向量数据库。</li>
<li>当需要相关记忆时，执行相似度搜索找出最相关的记忆。</li>
</ul>
</li>
</ol>
<h3 id="2-3-行动生成流程详解"><a href="#2-3-行动生成流程详解" class="headerlink" title="2.3 行动生成流程详解"></a>2.3 行动生成流程详解</h3><p>SAGA的核心功能是生成行动选项。</p>
<h4 id="2-3-1-详细流程图"><a href="#2-3-1-详细流程图" class="headerlink" title="2.3.1 详细流程图"></a>2.3.1 详细流程图</h4><p>下面是详细的行动生成流程：</p>
<pre class="mermaid">sequenceDiagram
    participant Client as 客户端/模拟环境
    participant Agent as ActionsAgent
    participant LLM as 语言模型
    participant Parser as JSON解析器
    
    Client->>Agent: 调用generate_actions(context, skills)
    Agent->>Agent: 验证输入
    Agent->>Agent: 构建Chain
    Agent->>Agent: 将skills转换为JSON
    Agent->>LLM: 发送提示和上下文
    LLM->>Agent: 返回原始响应
    Agent->>Parser: 解析JSON响应
    Parser->>Agent: 返回解析后的结构
    Agent->>Agent: 创建GeneratedActions对象
    Agent->>Agent: 按分数排序行动选项
    Agent->>Client: 返回GeneratedActions</pre>

<h4 id="2-3-2-提示模板设计"><a href="#2-3-2-提示模板设计" class="headerlink" title="2.3.2 提示模板设计"></a>2.3.2 提示模板设计</h4><p>SAGA使用YAML格式的提示模板来构建发送给语言模型的提示。以下是行动生成的模板：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">_type:</span> <span class="string">prompt</span></span><br><span class="line"><span class="attr">input_variables:</span></span><br><span class="line">    [<span class="string">&quot;context&quot;</span>, <span class="string">&quot;skills&quot;</span>]</span><br><span class="line"><span class="attr">template:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    Generate a list of different action options that your character should take next using the following skills:</span></span><br><span class="line"><span class="string">    &#123;skills&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    &#123;<span class="string">context</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="string">Generate</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">different</span> <span class="string">action</span> <span class="string">options</span> <span class="string">that</span> <span class="string">your</span> <span class="string">character</span> <span class="string">should</span> <span class="string">take.</span> <span class="string">Then</span> <span class="string">score</span> <span class="string">each</span> <span class="string">option.</span> <span class="string">Only</span> <span class="string">generate</span> <span class="string">valid</span> <span class="string">JSON.</span></span><br><span class="line">    <span class="attr">Use the following JSON format to specify the parameters:</span></span><br><span class="line">            &#123;&#123;<span class="attr">&quot;options&quot;:</span> [</span><br><span class="line">                &#123;&#123;<span class="attr">&quot;skill&quot;:</span> <span class="string">&lt;choice</span> <span class="string">of</span> <span class="string">skill&gt;</span>, <span class="attr">&quot;parameters&quot;:</span> &#123;&#123;<span class="string">&lt;skill</span> <span class="string">parameters</span> <span class="string">as</span> <span class="string">json&gt;</span>&#125;&#125;&#125;&#125;</span><br><span class="line">            ],<span class="attr">&quot;scores&quot;:</span> [<span class="string">&lt;list</span>[<span class="string">float</span>]<span class="string">:</span> <span class="string">scores</span> <span class="string">for</span> <span class="string">each</span> <span class="string">action</span> <span class="string">in</span> <span class="string">the</span> <span class="string">order</span> <span class="string">listed.</span> <span class="number">-1.0</span> <span class="string">is</span> <span class="string">terrible</span>, <span class="number">0</span> <span class="string">is</span> <span class="string">neutral</span>, <span class="string">and</span> <span class="number">1.0</span> <span class="string">the</span> <span class="string">best</span> <span class="string">action</span> <span class="string">ever.&gt;</span>]</span><br><span class="line">            ]&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-行动解析和排序"><a href="#2-3-3-行动解析和排序" class="headerlink" title="2.3.3 行动解析和排序"></a>2.3.3 行动解析和排序</h4><p>行动选项从LLM返回后，由<code>ActionsAgent</code>解析JSON响应，并使用<code>GeneratedActions</code>对象的<code>sort()</code>方法（如1.3节所示）按分数对行动选项进行排序。</p>
<h3 id="2-4-对话生成流程详解"><a href="#2-4-对话生成流程详解" class="headerlink" title="2.4 对话生成流程详解"></a>2.4 对话生成流程详解</h3><p>当角色需要进行对话时，模拟环境会调用<code>ConversationAgent</code>的<code>generate_conversation()</code>方法。此方法（如1.2.3节代码所示）接收参与对话的角色ID列表和当前上下文。它会构建一个专门的提示发送给语言模型，LLM随后返回JSON格式的对话内容。这些对话内容被构造成<code>GeneratedConversation</code>对象，并可以被保存为角色的记忆。</p>
<h3 id="2-5-完整的模拟执行流程"><a href="#2-5-完整的模拟执行流程" class="headerlink" title="2.5 完整的模拟执行流程"></a>2.5 完整的模拟执行流程</h3><h4 id="2-5-1-模拟环境中的用户交互驱动流程（以Space-Colony示例）"><a href="#2-5-1-模拟环境中的用户交互驱动流程（以Space-Colony示例）" class="headerlink" title="2.5.1 模拟环境中的用户交互驱动流程（以Space Colony示例）"></a>2.5.1 模拟环境中的用户交互驱动流程（以Space Colony示例）</h4><pre class="mermaid">sequenceDiagram
    participant User
    participant Simulation
    participant ActionsAgent
    participant LLM
    participant SimAction
    
    User->>Simulation: 运行示例
    Simulation->>Simulation: 加载元数据
    loop 每个角色
        Simulation->>ActionsAgent: generate_action_options(agent)
        ActionsAgent->>LLM: 发送上下文和技能
        LLM->>ActionsAgent: 返回行动选项
        ActionsAgent->>Simulation: 返回排序后的行动选项
        Simulation->>User: 显示行动选项列表
        User->>Simulation: 选择一个行动
        Simulation->>SimAction: 创建行动实例
        SimAction->>Simulation: 更新角色状态和记忆
    end</pre>

<h4 id="2-5-2-SAGA内部行动生成到执行的详细流程"><a href="#2-5-2-SAGA内部行动生成到执行的详细流程" class="headerlink" title="2.5.2 SAGA内部行动生成到执行的详细流程"></a>2.5.2 SAGA内部行动生成到执行的详细流程</h4><pre class="mermaid">sequenceDiagram
    participant Sim as 模拟系统
    participant Agent as 模拟代理
    participant Context as 上下文生成器
    participant SAGA as SAGA框架 (ActionsAgent)
    participant LLM as 语言模型
    participant ActionFactory as 行动工厂
    
    Sim->>Agent: tick(delta_time)
    Alt 需要新行动
        Agent->>Context: 请求生成上下文
        Context->>Context: 收集代理信息、环境信息、记忆等
        Context-->>Agent: 返回格式化上下文
        Agent->>SAGA: generate_actions(context, skills)
        SAGA->>LLM: 发送提示(context + skills)
        LLM-->>SAGA: 返回JSON格式行动选项和评分
        SAGA-->>Agent: 返回GeneratedActions对象
        Agent->>Agent: 选择行动(通常是最高评分)
        Agent->>ActionFactory: 创建行动实例 (e.g., sim_action_factory)
        ActionFactory-->>Agent: 返回具体SimAction子类实例
        Agent->>Agent: 设置当前action
    End
    
    Agent->>Agent: tick_action(delta_time) // 调用 SimAction.tick()
    Agent->>Agent: 更新行动状态和运行时间
    
    Alt 行动完成
        Agent->>Agent: 添加记忆 (e.g., MemoryStore.append)
        Agent->>Agent: action.complete()
        Agent->>Agent: action = None
    End
    
    Agent-->>Sim: 返回控制</pre>

<h2 id="3-记忆与嵌入机制"><a href="#3-记忆与嵌入机制" class="headerlink" title="3. 记忆与嵌入机制"></a>3. 记忆与嵌入机制</h2><p>SAGA的记忆系统利用向量嵌入来存储和检索记忆，从而使代理能够根据过去的经验做出更明智的决策。</p>
<h3 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h3><p>SAGA的记忆和嵌入机制工作流程如下：</p>
<pre class="mermaid">graph TD
    A[文本记忆] -->|嵌入生成| B[向量嵌入]
    B -->|存储| C[向量数据库]
    D[查询] -->|嵌入生成| E[查询向量]
    E -->|相似度搜索| C
    C -->|相关记忆| F[检索结果]</pre>

<h3 id="3-2-EmbeddingAgent-的作用"><a href="#3-2-EmbeddingAgent-的作用" class="headerlink" title="3.2 EmbeddingAgent 的作用"></a>3.2 <code>EmbeddingAgent</code> 的作用</h3><p><code>EmbeddingAgent</code> (详见1.2.4节) 在此机制中扮演核心角色。它负责：</p>
<ol>
<li>将文本（如观察、对话、思考）转换为向量嵌入。</li>
<li>将这些嵌入及其原始文本（和元数据）存储到向量存储中。</li>
<li>当需要检索相关记忆时，将查询文本转换为查询向量，并在向量存储中执行相似度搜索。</li>
</ol>
<h3 id="3-3-SimpleVectorStore-实现"><a href="#3-3-SimpleVectorStore-实现" class="headerlink" title="3.3 SimpleVectorStore 实现"></a>3.3 <code>SimpleVectorStore</code> 实现</h3><p><code>SimpleVectorStore</code>是一个简单的内存向量存储实现，使用numpy进行相似度搜索。它是SAGA中用于演示和快速启动的默认向量存储。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleVectorStore</span>(<span class="title class_ inherited__">VectorStore</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, embedding_model: Embeddings</span>):</span><br><span class="line">        self.embedding_model = embedding_model</span><br><span class="line">        self.vectors = []</span><br><span class="line">        self.ids = []</span><br><span class="line">        self.docstore = InMemoryDocstore()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_texts</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        texts: Iterable[<span class="built_in">str</span>],</span></span><br><span class="line"><span class="params">        metadatas: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">Dict</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        ids: <span class="type">Optional</span>[<span class="type">List</span>[<span class="built_in">str</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加文本到向量存储&quot;&quot;&quot;</span></span><br><span class="line">        embedding_values = self.embedding_model.embed_documents(<span class="built_in">list</span>(texts))</span><br><span class="line">        <span class="keyword">if</span> ids <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            ids = [uuid.uuid4().<span class="built_in">hex</span> <span class="keyword">for</span> _ <span class="keyword">in</span> texts]</span><br><span class="line">        self.ids.extend(ids)</span><br><span class="line">        self.vectors.extend(np.array(embedding_values))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建文档并存储</span></span><br><span class="line">        <span class="keyword">if</span> metadatas <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            docs = [</span><br><span class="line">                LangchainDocument(page_content=text, metadata=metadata)</span><br><span class="line">                <span class="keyword">for</span> text, metadata <span class="keyword">in</span> <span class="built_in">zip</span>(texts, metadatas)</span><br><span class="line">            ]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            docs = [LangchainDocument(text) <span class="keyword">for</span> text <span class="keyword">in</span> texts]</span><br><span class="line">        </span><br><span class="line">        self.docstore.add(<span class="built_in">dict</span>(<span class="built_in">zip</span>(ids, docs)))</span><br><span class="line">        <span class="keyword">return</span> ids</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">similarity_search_with_score</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, query: <span class="built_in">str</span>, k: <span class="built_in">int</span> = <span class="number">5</span>, **kwargs</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">List</span>[<span class="type">Tuple</span>[LangchainDocument, <span class="built_in">float</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;查找相似向量并返回相关性分数&quot;&quot;&quot;</span></span><br><span class="line">        query_embedding = self.embedding_model.embed_query(query)</span><br><span class="line">        cos_sim = np.array(</span><br><span class="line">            [</span><br><span class="line">                self.cosine_similarity_numpy(np.array(query_embedding, ndmin=<span class="number">2</span>), vector)</span><br><span class="line">                <span class="keyword">for</span> vector <span class="keyword">in</span> self.vectors</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 余弦相似度范围从-1到1，归一化到0-1</span></span><br><span class="line">        scores = (cos_sim.flatten() + <span class="number">1</span>) / <span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 按分数排序，取前k个</span></span><br><span class="line">        indices = np.argsort(scores, axis=<span class="number">0</span>)[::-<span class="number">1</span>][:k]</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> indices:</span><br><span class="line">            doc = self.docstore.search(self.ids[i])</span><br><span class="line">            results.append((doc, scores[i]))</span><br><span class="line">        <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>

<h3 id="3-4-记忆和元记忆处理"><a href="#3-4-记忆和元记忆处理" class="headerlink" title="3.4 记忆和元记忆处理"></a>3.4 记忆和元记忆处理</h3><p>元记忆处理是SAGA框架的核心特点之一，它允许代理不仅存储事实，还存储关于其自身状态、目标和知识的结构化信息。</p>
<p><strong>元记忆典型数据结构示例：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;agent_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cooper&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;persona&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Wyatt Cooper&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Sheriff&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;goals&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Solve the murder case&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Maintain peace in town&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;knowledge&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;world&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Thistle Gulch is a small western town&quot;</span><span class="punctuation">,</span> <span class="string">&quot;...&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;people&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;blackjack&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;relation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;suspicious&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;observations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;Native American man found dead&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Fresh blood and bullet casings&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;crime_scene&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;skills&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;goto&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;destination&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;interact&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;item&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;interaction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;conversewith&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;persona&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;current_goal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Find the murderer before tribal retaliation&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>记忆处理流程：</strong></p>
<ol>
<li>模拟系统维护每个代理的记忆库（例如使用<code>MemoryStore</code>，它可能内部使用<code>EmbeddingAgent</code>和<code>VectorStore</code>）。</li>
<li>新的行动结果、观察和对话被添加为记忆条目到记忆库中。</li>
<li>在为<code>ActionsAgent</code>或<code>ConversationAgent</code>构建上下文时，系统会从记忆库中检索相关记忆。这通常涉及将当前情况或查询嵌入化，然后通过向量相似度搜索找到语义相关的记忆。</li>
<li>检索到的记忆被格式化并包含在提供给LLM的上下文中，以指导其生成行动或对话。</li>
<li>一些记忆系统可能会实现记忆的淡忘特性，使得较旧或较少访问的记忆随时间变得不那么突出或检索权重降低。</li>
</ol>
<h2 id="4-模拟环境集成"><a href="#4-模拟环境集成" class="headerlink" title="4. 模拟环境集成"></a>4. 模拟环境集成</h2><p>SAGA提供了一个Space Colony示例，展示了如何将框架集成到模拟环境中。集成的关键在于将SAGA的代理（如<code>ActionsAgent</code>）与模拟世界中的代理（<code>SimAgent</code>）连接起来，并通过模拟行动（<code>SimAction</code>）来执行SAGA生成的决策。</p>
<h3 id="4-1-模拟代理-SimAgent"><a href="#4-1-模拟代理-SimAgent" class="headerlink" title="4.1 模拟代理 (SimAgent)"></a>4.1 模拟代理 (<code>SimAgent</code>)</h3><p><code>SimAgent</code>是模拟环境中的代理，它持有一个角色（persona）、位置、技能列表和当前正在执行的行动。它还拥有一个<code>MemoryStore</code>来存储其记忆。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@define(<span class="params">slots=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimAgent</span>:</span><br><span class="line">    guid: <span class="built_in">str</span></span><br><span class="line">    persona: sim_models.Persona</span><br><span class="line">    location: sim_models.Location</span><br><span class="line">    skills: <span class="type">List</span>[Skill] = []</span><br><span class="line">    action: <span class="type">Optional</span>[SimAction] = <span class="literal">None</span></span><br><span class="line">    memories: MemoryStore = MemoryStore([])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">tick</span>(<span class="params">self, delta: timedelta, sim: <span class="string">&quot;Simulation&quot;</span></span>):</span><br><span class="line">        <span class="comment"># 如果没有当前行动，选择一个新行动</span></span><br><span class="line">        <span class="keyword">if</span> self.action <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            actions = <span class="keyword">await</span> sim.action_generator.generate_action_options(</span><br><span class="line">                sim, self, verbose=<span class="literal">False</span></span><br><span class="line">            )</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 让用户或AI选择一个行动</span></span><br><span class="line">            idx = <span class="keyword">await</span> choose_action(actions)</span><br><span class="line">            new_action = sim.action_generator.sim_action_factory(</span><br><span class="line">                self, actions.options[idx]</span><br><span class="line">            )</span><br><span class="line">            self.action = new_action</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 推进当前行动</span></span><br><span class="line">        <span class="keyword">await</span> self.tick_action(delta, sim)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-模拟行动-SimAction"><a href="#4-2-模拟行动-SimAction" class="headerlink" title="4.2 模拟行动 (SimAction)"></a>4.2 模拟行动 (<code>SimAction</code>)</h3><p><code>SimAction</code>及其子类实现了代理可以执行的各种具体行动。每个<code>SimAction</code>子类对应一个SAGA <code>Skill</code>。当一个行动被选择后，其实例被创建，并且其<code>tick()</code>方法会在模拟的每个时间步被调用，直到行动完成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimAction</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent: SimAgent, action_data: Action</span>):</span><br><span class="line">        self.agent = agent</span><br><span class="line">        self.action_data = action_data</span><br><span class="line">        self.skill = action_data.skill</span><br><span class="line">        self.parameters = action_data.parameters</span><br><span class="line">        self.start_time = <span class="literal">None</span></span><br><span class="line">        self.run_time = timedelta()</span><br><span class="line">        self.end_time = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">tick</span>(<span class="params">self, delta: timedelta, sim: Simulation</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新行动的运行时间&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.start_time <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.start_time = sim.sim_time</span><br><span class="line">        self.run_time += delta</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">complete</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;标记行动为完成&quot;&quot;&quot;</span></span><br><span class="line">        self.agent.action = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoTo</span>(<span class="title class_ inherited__">SimAction</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent: SimAgent, action_data: Action</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(agent, action_data)</span><br><span class="line">        self.destination = self.parameters.get(<span class="string">&quot;destination&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        self.goal = self.parameters.get(<span class="string">&quot;goal&quot;</span>, <span class="string">&quot;None&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">tick</span>(<span class="params">self, delta: timedelta, sim: Simulation</span>):</span><br><span class="line">        <span class="keyword">await</span> <span class="built_in">super</span>().tick(delta, sim)</span><br><span class="line">        <span class="comment"># 假设移动到下一个位置需要一分钟</span></span><br><span class="line">        <span class="keyword">if</span> self.run_time.total_seconds() &lt; <span class="number">60</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 更新代理位置</span></span><br><span class="line">        previous_location = self.agent.location.guid</span><br><span class="line">        self.agent.location = sim.locations[EntityId(self.destination)]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 创建记忆</span></span><br><span class="line">        summary = <span class="string">f&quot;Moved from <span class="subst">&#123;previous_location&#125;</span> to <span class="subst">&#123;self.destination&#125;</span> with goal <span class="subst">&#123;self.goal&#125;</span>&quot;</span></span><br><span class="line">        self.agent.memories.append(</span><br><span class="line">            sim_models.Memory(summary=summary, timestamp=sim.sim_time)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 完成行动</span></span><br><span class="line">        self.end_time = sim.sim_time</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;self.agent.persona.<span class="built_in">id</span>()&#125;</span>: <span class="subst">&#123;summary&#125;</span>&quot;</span>)</span><br><span class="line">        self.complete()</span><br></pre></td></tr></table></figure>

<h3 id="4-3-行动生成器-ActionGenerator"><a href="#4-3-行动生成器-ActionGenerator" class="headerlink" title="4.3 行动生成器 (ActionGenerator)"></a>4.3 行动生成器 (<code>ActionGenerator</code>)</h3><p><code>ActionGenerator</code>是模拟环境中的一个辅助类，它封装了与SAGA <code>ActionsAgent</code>的交互，以便为<code>SimAgent</code>生成行动选项。它还包含一个工厂方法 (<code>sim_action_factory</code>)，用于将SAGA返回的抽象<code>Action</code>数据转换为具体的<code>SimAction</code>子类实例。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ActionGenerator</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, saga_agent: ActionsAgent</span>):</span><br><span class="line">        self.saga_agent = saga_agent</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_action_options</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        sim: Simulation,</span></span><br><span class="line"><span class="params">        sim_agent: SimAgent,</span></span><br><span class="line"><span class="params">        retries=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">        verbose=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; GeneratedActions:</span><br><span class="line">        <span class="comment"># 构建上下文</span></span><br><span class="line">        context = Format.standard_llm_context(sim_agent, sim)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成行动选项</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self.saga_agent.generate_actions(</span><br><span class="line">            context, sim_agent.skills, retries, verbose</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sim_action_factory</span>(<span class="params">sim_agent: SimAgent, action: Action</span>):</span><br><span class="line">        <span class="comment"># 根据技能名创建对应的SimAction子类实例</span></span><br><span class="line">        <span class="keyword">if</span> action.skill == <span class="string">&quot;go_to&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> GoTo(sim_agent, action)</span><br><span class="line">        <span class="keyword">elif</span> action.skill == <span class="string">&quot;interact&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> Interact(sim_agent, action)</span><br><span class="line">        <span class="keyword">elif</span> action.skill == <span class="string">&quot;converse_with&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> ConverseWith(sim_agent, action)</span><br><span class="line">        <span class="keyword">elif</span> action.skill == <span class="string">&quot;wait&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> Wait(sim_agent, action)</span><br><span class="line">        <span class="keyword">elif</span> action.skill == <span class="string">&quot;reflect&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> Reflect(sim_agent, action)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;Unknown skill: <span class="subst">&#123;action.skill&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="5-服务器实现"><a href="#5-服务器实现" class="headerlink" title="5. 服务器实现"></a>5. 服务器实现</h2><p>SAGA可以作为服务器运行，通过HTTP、WebSocket或SocketIO等协议提供接口，使得非Python或其他外部模拟环境也能利用SAGA的AI代理能力。</p>
<h3 id="5-1-架构概述"><a href="#5-1-架构概述" class="headerlink" title="5.1 架构概述"></a>5.1 架构概述</h3><p>SAGA服务器架构允许外部客户端与核心SAGA代理进行交互：</p>
<pre class="mermaid">graph TD
    A[客户端] -->|请求| B{服务器类型}
    B -->|HTTP| C[HTTP处理器]
    B -->|WebSocket| D[WebSocket处理器]
    B -->|SocketIO| E[SocketIO处理器]
    C -->|处理请求| F[端点]
    D -->|处理请求| F
    E -->|处理请求| F
    F -->|ActionsEndpoint| G[ActionsAgent]
    F -->|ConversationEndpoint| H[ConversationAgent]
    F -->|EmbeddingsEndpoint| I[EmbeddingAgent]
    G -->|返回行动| F
    H -->|返回对话| F
    I -->|返回嵌入| F
    F -->|构建响应| C
    F -->|构建响应| D
    F -->|构建响应| E
    C -->|响应| A
    D -->|响应| A
    E -->|响应| A</pre>

<h3 id="5-2-端点设计"><a href="#5-2-端点设计" class="headerlink" title="5.2 端点设计"></a>5.2 端点设计</h3><p>SAGA的服务器使用统一的端点设计模式，每个端点负责处理特定类型的请求并与相应的SAGA代理交互。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseEndpoint</span>(<span class="type">Generic</span>[TReq, TResp]):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;所有端点的基类&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, request: TReq</span>) -&gt; TResp:</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ActionsEndpoint</span>(BaseEndpoint[ActionsRequest, ActionsResponse]):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从ActionsRequest生成ActionsResponse&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent: ActionsAgent</span>):</span><br><span class="line">        self.agent = agent</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">handle_request</span>(<span class="params">self, req: ActionsRequest</span>) -&gt; ActionsResponse:</span><br><span class="line">        actions = <span class="keyword">await</span> self.agent.generate_actions(</span><br><span class="line">            req.context, req.skills, req.retries, req.verbose</span><br><span class="line">        )</span><br><span class="line">        response = ActionsResponse(actions=actions, reference=req.reference)</span><br><span class="line">        <span class="keyword">if</span> actions.error <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            response.error = <span class="string">f&quot;Generation Error: <span class="subst">&#123;actions.error&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="5-3-HTTP服务器"><a href="#5-3-HTTP服务器" class="headerlink" title="5.3 HTTP服务器"></a>5.3 HTTP服务器</h3><p>HTTP服务器通常使用像<code>aiohttp</code>这样的异步Web框架实现。请求被路由到相应的端点处理器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@routes.post(<span class="params"><span class="string">&quot;/generate-actions&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_actions</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = <span class="keyword">await</span> request.json()</span><br><span class="line">        result = <span class="keyword">await</span> generic_handler(data, actions_endpoint)</span><br><span class="line">        <span class="keyword">return</span> web.json_response(result)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> web.json_response(</span><br><span class="line">            &#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Error in generate_actions: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;, status=<span class="number">500</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<h3 id="5-4-WebSocket和SocketIO"><a href="#5-4-WebSocket和SocketIO" class="headerlink" title="5.4 WebSocket和SocketIO"></a>5.4 WebSocket和SocketIO</h3><p>WebSocket和SocketIO接口为需要实时、双向通信的客户端提供支持。它们允许服务器在生成结果后主动将结果推送给客户端。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@sio.on(<span class="params"><span class="string">&quot;generate-actions&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_actions</span>(<span class="params">sid, message_str: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="keyword">await</span> generic_handler(message_str, actions_endpoint)</span><br><span class="line">        <span class="keyword">await</span> sio.emit(<span class="string">&quot;generate-actions&quot;</span>, json.dumps(result), room=sid)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">await</span> sio.emit(</span><br><span class="line">            <span class="string">&quot;generate-actions&quot;</span>,</span><br><span class="line">            json.dumps(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">f&quot;Error in generate_actions: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>&#125;),</span><br><span class="line">            room=sid,</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text"><span class="toc-number">1.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Announcing-SAGA-Skill-to-Action-Generation-for-Agents"><span class="toc-number"></span> <span class="toc-text">Announcing SAGA: Skill to Action Generation for Agents.</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation"><span class="toc-number">2.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%A3%E5%B8%83SAGA%EF%BC%9A%E9%9D%A2%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E6%8A%80%E8%83%BD%E5%88%B0%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E6%A1%86%E6%9E%B6"><span class="toc-number"></span> <span class="toc-text">宣布SAGA：面向代理的技能到行动生成框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-1"><span class="toc-number">2.</span> <span class="toc-text">英文原文 (Original Text)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Skills-in-Action"><span class="toc-number">2.1.</span> <span class="toc-text">Skills in Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Examples"><span class="toc-number">2.2.</span> <span class="toc-text">Examples</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-1"><span class="toc-number">3.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E8%83%BD%E4%BB%98%E8%AF%B8%E8%A1%8C%E5%8A%A8"><span class="toc-number">3.1.</span> <span class="toc-text">技能付诸行动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.2.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-2"><span class="toc-number">4.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pairing-With-a-Simulation"><span class="toc-number">5.</span> <span class="toc-text">Pairing With a Simulation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-2"><span class="toc-number">6.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E6%A8%A1%E6%8B%9F%E7%B3%BB%E7%BB%9F%E9%85%8D%E5%AF%B9"><span class="toc-number">7.</span> <span class="toc-text">与模拟系统配对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-3"><span class="toc-number">8.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Murder-in-Thistle-Gulch"><span class="toc-number">9.</span> <span class="toc-text">Murder in Thistle Gulch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Personas"><span class="toc-number">9.1.</span> <span class="toc-text">Personas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Meta-Memories"><span class="toc-number">9.2.</span> <span class="toc-text">Meta-Memories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-3"><span class="toc-number">10.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%93%9F%E8%8D%89%E5%B3%A1%E8%B0%B7%E4%B8%AD%E7%9A%84%E8%B0%8B%E6%9D%80%E6%A1%88"><span class="toc-number">11.</span> <span class="toc-text">蓟草峡谷中的谋杀案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E8%AE%BE%E5%AE%9A"><span class="toc-number">11.1.</span> <span class="toc-text">角色设定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E8%AE%B0%E5%BF%86"><span class="toc-number">11.2.</span> <span class="toc-text">元记忆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-4"><span class="toc-number">12.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Murder-Investigation"><span class="toc-number">13.</span> <span class="toc-text">The Murder Investigation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sheriff-Cooper"><span class="toc-number">13.1.</span> <span class="toc-text">Sheriff Cooper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Saloon-Owner"><span class="toc-number">13.2.</span> <span class="toc-text">Saloon Owner</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-4"><span class="toc-number">14.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%8B%E6%9D%80%E8%B0%83%E6%9F%A5"><span class="toc-number">15.</span> <span class="toc-text">谋杀调查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sheriff-Cooper-1"><span class="toc-number">15.1.</span> <span class="toc-text">Sheriff Cooper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%92%E9%A6%86%E8%80%81%E6%9D%BF"><span class="toc-number">15.2.</span> <span class="toc-text">酒馆老板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-5"><span class="toc-number">16.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cooperation-and-Conflict"><span class="toc-number">17.</span> <span class="toc-text">Cooperation and Conflict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-5"><span class="toc-number">18.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E4%BD%9C%E4%B8%8E%E5%86%B2%E7%AA%81"><span class="toc-number">19.</span> <span class="toc-text">合作与冲突</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-6"><span class="toc-number">20.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-6"><span class="toc-number">21.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-7"><span class="toc-number">22.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Related-Work"><span class="toc-number">23.</span> <span class="toc-text">Related Work</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI-Planning-in-Context"><span class="toc-number">24.</span> <span class="toc-text">AI Planning in Context</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-7"><span class="toc-number">25.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C"><span class="toc-number">26.</span> <span class="toc-text">相关工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E8%A7%84%E5%88%92%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">27.</span> <span class="toc-text">AI规划的上下文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-8"><span class="toc-number">28.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Language-Models-as-Zero-Shot-Planners"><span class="toc-number">29.</span> <span class="toc-text">Language Models as Zero-Shot Planners</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generative-Human-like-Agents"><span class="toc-number">30.</span> <span class="toc-text">Generative Human-like Agents</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-8"><span class="toc-number">31.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E9%9B%B6%E6%A0%B7%E6%9C%AC%E8%A7%84%E5%88%92%E5%99%A8%E7%9A%84%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B"><span class="toc-number">32.</span> <span class="toc-text">作为零样本规划器的语言模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E7%B1%BB%E4%BA%BA%E4%BB%A3%E7%90%86"><span class="toc-number">33.</span> <span class="toc-text">生成式类人代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-9"><span class="toc-number">34.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interacting-With-and-Planning-in-a-3D-World"><span class="toc-number">35.</span> <span class="toc-text">Interacting With and Planning in a 3D World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-9"><span class="toc-number">36.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A83D%E4%B8%96%E7%95%8C%E4%B8%AD%E4%BA%A4%E4%BA%92%E5%92%8C%E8%A7%84%E5%88%92"><span class="toc-number">37.</span> <span class="toc-text">在3D世界中交互和规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-10"><span class="toc-number">38.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Next-Steps"><span class="toc-number">39.</span> <span class="toc-text">Next Steps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Challenges-for-Production-Use"><span class="toc-number">40.</span> <span class="toc-text">Challenges for Production Use</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generation-Times"><span class="toc-number">40.1.</span> <span class="toc-text">Generation Times</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-and-Prompt-Size-Limits"><span class="toc-number">40.2.</span> <span class="toc-text">Memory and Prompt Size Limits</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-10"><span class="toc-number">41.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5"><span class="toc-number">42.</span> <span class="toc-text">下一步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-number">43.</span> <span class="toc-text">生产使用的挑战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%97%B6%E9%97%B4"><span class="toc-number">43.1.</span> <span class="toc-text">生成时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%92%8C%E6%8F%90%E7%A4%BA%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6"><span class="toc-number">43.2.</span> <span class="toc-text">内存和提示大小限制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8B%B1%E6%96%87%E5%8E%9F%E6%96%87-Original-Text-11"><span class="toc-number">44.</span> <span class="toc-text">英文原文 (Original Text)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAGA%E2%80%99s-Future-Goals"><span class="toc-number">45.</span> <span class="toc-text">SAGA’s Future Goals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91-Chinese-Translation-11"><span class="toc-number">46.</span> <span class="toc-text">中文翻译 (Chinese Translation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SAGA%E7%9A%84%E6%9C%AA%E6%9D%A5%E7%9B%AE%E6%A0%87"><span class="toc-number">47.</span> <span class="toc-text">SAGA的未来目标</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SAGA%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E6%B5%81%E7%A8%8B%E8%AF%A6%E7%BB%86%E8%A7%A3%E6%9E%90"><span class="toc-number"></span> <span class="toc-text">SAGA项目代码流程详细解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SAGA%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E4%B8%8E%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">1. SAGA核心架构与组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BB%E8%A6%81%E7%BB%84%E4%BB%B6%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 主要组件概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 核心组件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-BaseSagaAgent"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 BaseSagaAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-ActionsAgent"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 ActionsAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-ConversationAgent"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 ConversationAgent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-EmbeddingAgent"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 EmbeddingAgent</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 关键数据结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">2. 核心工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%80%BB%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 总体流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AF%A6%E7%BB%86%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 详细执行流程概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 行动生成流程详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 详细流程图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E6%8F%90%E7%A4%BA%E6%A8%A1%E6%9D%BF%E8%AE%BE%E8%AE%A1"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 提示模板设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E8%A1%8C%E5%8A%A8%E8%A7%A3%E6%9E%90%E5%92%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 行动解析和排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AF%B9%E8%AF%9D%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 对话生成流程详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%AE%8C%E6%95%B4%E7%9A%84%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 完整的模拟执行流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E7%94%A8%E6%88%B7%E4%BA%A4%E4%BA%92%E9%A9%B1%E5%8A%A8%E6%B5%81%E7%A8%8B%EF%BC%88%E4%BB%A5Space-Colony%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 模拟环境中的用户交互驱动流程（以Space Colony示例）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-SAGA%E5%86%85%E9%83%A8%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E5%88%B0%E6%89%A7%E8%A1%8C%E7%9A%84%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 SAGA内部行动生成到执行的详细流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AE%B0%E5%BF%86%E4%B8%8E%E5%B5%8C%E5%85%A5%E6%9C%BA%E5%88%B6"><span class="toc-number">3.</span> <span class="toc-text">3. 记忆与嵌入机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-EmbeddingAgent-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 EmbeddingAgent 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SimpleVectorStore-%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 SimpleVectorStore 实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%AE%B0%E5%BF%86%E5%92%8C%E5%85%83%E8%AE%B0%E5%BF%86%E5%A4%84%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 记忆和元记忆处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E9%9B%86%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">4. 模拟环境集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%A8%A1%E6%8B%9F%E4%BB%A3%E7%90%86-SimAgent"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 模拟代理 (SimAgent)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%A8%A1%E6%8B%9F%E8%A1%8C%E5%8A%A8-SimAction"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 模拟行动 (SimAction)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E8%A1%8C%E5%8A%A8%E7%94%9F%E6%88%90%E5%99%A8-ActionGenerator"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 行动生成器 (ActionGenerator)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">5. 服务器实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 架构概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%AB%AF%E7%82%B9%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 端点设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 HTTP服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-WebSocket%E5%92%8CSocketIO"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 WebSocket和SocketIO</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/05/24/saga_translation_with_images/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://example.com/2025/05/24/saga_translation_with_images/&text=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/05/24/saga_translation_with_images/&is_video=false&description=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SAGA 面向代理的技能到行动生成框架&body=Check out this article: http://example.com/2025/05/24/saga_translation_with_images/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://example.com/2025/05/24/saga_translation_with_images/&title=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://example.com/2025/05/24/saga_translation_with_images/&name=SAGA 面向代理的技能到行动生成框架&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/05/24/saga_translation_with_images/&t=SAGA 面向代理的技能到行动生成框架"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2022-2025
        Reinhart
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">Home</a></li><!--
        --><!--
          --><li><a href="/search/">Search</a></li><!--
        --><!--
          --><li><a href="/about/">About</a></li><!--
        --><!--
          --><li><a href="/archives/">Writing</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- 不蒜子统计 -->
              <span class="site-pv">
                <i class="fa fa-eye"></i> 
                  <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
              </span>
              <span class="post-meta-divider">|</span>
              <span class="site-uv">
                <i class="fa fa-user"></i> 
                  <span class="busuanzi-user" id="busuanzi_value_site_uv"></span>
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?8f0c35c575c71287b5578dafdd00a358";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'reinhart';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
